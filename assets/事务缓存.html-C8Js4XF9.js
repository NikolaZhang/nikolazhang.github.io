import{_ as t}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as e,e as n,o as i}from"./app-tiuAdH6w.js";const o={};function c(r,a){return i(),e("div",null,[...a[0]||(a[0]=[n('<h2 id="事务缓存-transactionalcache" tabindex="-1"><a class="header-anchor" href="#事务缓存-transactionalcache"><span>事务缓存 TransactionalCache</span></a></h2><p><code>TransactionalCacheManager</code>用于管理所有的<code>TransactionalCache</code>事务缓存。其结构为<code>Map&lt;Cache, TransactionalCache&gt;</code>。</p><p>通过<code>MapperStatement</code>中的<code>Cache</code>，从事务缓存管理器中获取<code>TransactionalCache</code>，通过<code>TransactionalCache</code>进行缓存操作。</p><p><code>TransactionalCache</code>中存在一个<code>Map&lt;Object, Object&gt; entriesToAddOnCommit</code>用于存储缓存记录；<code>Set&lt;Object&gt; entriesMissedInCache</code>用于记录未命中的缓存记录。每次查询、更新操作，事务管理器都会对这两个缓存进行操作，此时临时缓存的数据还没有写入二级缓存，只有执行提交操作，这两个缓存数据才会正式写入二级缓存。这种操作方式，符合数据库的事务特性，即：事务提交之前，只操作临时缓存，不操作二级缓存，因此不会影响其他事务；事务提交之后，缓存写入二级缓存，此时对所有事务可见。对二级缓存的操作，是整个事务一起提交的，符合原子特性。</p><p>为什么要记录未命中缓存的key？缓存未命中的key可以防止缓存穿透，当大量请求数据库不存在的数据时，通过缓存，可以防止频繁查询数据库。</p><p>事务缓存存在以下操作：</p><ul><li>添加缓存记录：<code>putObject(Object key, Object value)</code></li><li>获取缓存记录：<code>getObject(Object key)</code></li><li>清空缓存：<code>clear()</code></li><li>提交事务：<code>commit()</code></li><li>回滚事务：<code>rollback()</code></li></ul><p>下面是对这几个操作的流程解析：</p><p><img src="https://raw.githubusercontent.com/NikolaZhang/image-blog/main/mybatis缓存架构/Snipaste_2024-11-04_16-06-42.png" alt="Snipaste_2024-11-04_16-06-42" loading="lazy"><img src="https://raw.githubusercontent.com/NikolaZhang/image-blog/main/mybatis缓存架构/Snipaste_2024-11-04_16-07-08.png" alt="Snipaste_2024-11-04_16-07-08" loading="lazy"><img src="https://raw.githubusercontent.com/NikolaZhang/image-blog/main/mybatis缓存架构/Snipaste_2024-11-04_16-07-50.png" alt="Snipaste_2024-11-04_16-07-08" loading="lazy"></p><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>一定需要注意的是，二级缓存的写入发生在事务提交或者回滚阶段，而不是在查询阶段。</p></div>',10)])])}const p=t(o,[["render",c]]),m=JSON.parse('{"path":"/posts/mybatis/%E4%BA%8B%E5%8A%A1%E7%BC%93%E5%AD%98.html","title":"mybatis事务缓存","lang":"en-US","frontmatter":{"title":"mybatis事务缓存","tag":["mybatis","事务缓存"],"category":"mybatis","description":"事务缓存 TransactionalCache TransactionalCacheManager用于管理所有的TransactionalCache事务缓存。其结构为Map<Cache, TransactionalCache>。 通过MapperStatement中的Cache，从事务缓存管理器中获取TransactionalCache，通过Trans...","banner":"http://image.nikolazhang.top/wallhaven-nrwq11.jpg","date":"2024-11-09T00:00:00.000Z","author":"nikola","icon":"article","isOriginal":true,"sticky":false,"timeline":true,"article":true,"star":false,"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"mybatis事务缓存\\",\\"image\\":[\\"https://raw.githubusercontent.com/NikolaZhang/image-blog/main/mybatis缓存架构/Snipaste_2024-11-04_16-06-42.png\\",\\"https://raw.githubusercontent.com/NikolaZhang/image-blog/main/mybatis缓存架构/Snipaste_2024-11-04_16-07-08.png\\",\\"https://raw.githubusercontent.com/NikolaZhang/image-blog/main/mybatis缓存架构/Snipaste_2024-11-04_16-07-50.png\\"],\\"datePublished\\":\\"2024-11-09T00:00:00.000Z\\",\\"dateModified\\":\\"2024-12-31T08:40:08.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"nikola\\"}]}"],["meta",{"property":"og:url","content":"https://nikolazhang.github.io/posts/mybatis/%E4%BA%8B%E5%8A%A1%E7%BC%93%E5%AD%98.html"}],["meta",{"property":"og:title","content":"mybatis事务缓存"}],["meta",{"property":"og:description","content":"事务缓存 TransactionalCache TransactionalCacheManager用于管理所有的TransactionalCache事务缓存。其结构为Map<Cache, TransactionalCache>。 通过MapperStatement中的Cache，从事务缓存管理器中获取TransactionalCache，通过Trans..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"http://image.nikolazhang.top/wallhaven-nrwq11.jpg"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-12-31T08:40:08.000Z"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"http://image.nikolazhang.top/wallhaven-nrwq11.jpg"}],["meta",{"name":"twitter:image:alt","content":"mybatis事务缓存"}],["meta",{"property":"article:author","content":"nikola"}],["meta",{"property":"article:tag","content":"事务缓存"}],["meta",{"property":"article:tag","content":"mybatis"}],["meta",{"property":"article:published_time","content":"2024-11-09T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-12-31T08:40:08.000Z"}]]},"git":{"createdTime":1731204251000,"updatedTime":1735634408000,"contributors":[{"name":"我小叮当","username":"","email":"nikolazhang@163.com","commits":3}]},"readingTime":{"minutes":1.63,"words":489},"filePathRelative":"posts/mybatis/事务缓存.md","autoDesc":true}');export{p as comp,m as data};
