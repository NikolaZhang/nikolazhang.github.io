import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as s,f as t,e as l,o as i}from"./app-DusMNI10.js";const d={};function r(p,e){return i(),a("div",null,[e[0]||(e[0]=s("h2",{id:"_1-sql-server",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_1-sql-server"},[s("span",null,"1. sql server")])],-1)),e[1]||(e[1]=s("blockquote",null,[s("p",null,"最近打算把mysql,sql server,oracle数据库的基操整理一下. [三天假期, 我就这么无聊吗?] 其实也主要是为了防止弄混. 对于新手这是一个快速入门教程. 对于记忆不好的,容易弄混的,这是一个提词器.欢迎各位路过的客官进行补充. 多谢~")],-1)),t("more"),e[2]||(e[2]=l(`<h3 id="_1-1-数据类型" tabindex="-1"><a class="header-anchor" href="#_1-1-数据类型"><span>1.1 数据类型</span></a></h3><table><thead><tr><th style="text-align:left;">数字类型</th><th style="text-align:left;">变量类型</th><th style="text-align:left;">大小</th><th style="text-align:left;">使用</th></tr></thead><tbody><tr><td style="text-align:left;">整数</td><td style="text-align:left;">tinyint</td><td style="text-align:left;">1字节</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">smallint</td><td style="text-align:left;">2字节</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">int</td><td style="text-align:left;">4字节</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">bigint</td><td style="text-align:left;">8字节</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">浮点数</td><td style="text-align:left;">float</td><td style="text-align:left;">8字节</td><td style="text-align:left;">可精确到第15位小数(范围:-1.79E308 到1.79E+308)</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">real</td><td style="text-align:left;">4字节</td><td style="text-align:left;">精确到第7位小数(范围:-3.40E38 到 ~3.40E38)</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">decimal</td><td style="text-align:left;">5~17字节</td><td style="text-align:left;">decimal(数字位数,小数位数): 数字位数最大38位</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">numeric</td><td style="text-align:left;">同上</td><td style="text-align:left;">使用方法同上,都是四舍五入</td></tr><tr><td style="text-align:left;">字符类型</td><td style="text-align:left;">char</td><td style="text-align:left;">1~8000</td><td style="text-align:left;">长度固定,短时补充空格,长时截取</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">varchar</td><td style="text-align:left;">1~8000</td><td style="text-align:left;">不会补充空格，长度可变。但超出时依旧会截取</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">nchar</td><td style="text-align:left;">(1~4000)×2</td><td style="text-align:left;">每一个字符为两个字节</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">nvarchar</td><td style="text-align:left;">(1~4000)×2</td><td style="text-align:left;">每一个字符为两个字节。其他同varchar</td></tr><tr><td style="text-align:left;">日期类型</td><td style="text-align:left;">date</td><td style="text-align:left;">3字节</td><td style="text-align:left;">日期。从公元元年1月1日到9999年12月31日</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">datetime</td><td style="text-align:left;">8字节</td><td style="text-align:left;">日期 时间。从公元1753年1月1日00:00:00.000 到9999年12月31日23:59:59.997 ，精确到3.33毫秒</td></tr></tbody></table><blockquote><p><strong>p.s.:</strong></p></blockquote><ol><li>查看字节数可以使用datalength(express)</li><li>一个汉字是两个字节</li></ol><p><a href="https://www.cnblogs.com/HDK2016/p/7782303.html" title="参考链接" target="_blank" rel="noopener noreferrer">【SqlServer】Sql Server 支持的数据类型</a></p><h2 id="_1-2-常用方法" tabindex="-1"><a class="header-anchor" href="#_1-2-常用方法"><span>1.2 常用方法</span></a></h2><h3 id="_1-2-1-转换" tabindex="-1"><a class="header-anchor" href="#_1-2-1-转换"><span>1.2.1 转换</span></a></h3><table><thead><tr><th style="text-align:left;">方法名</th><th style="text-align:left;">作用</th><th style="text-align:left;">示例</th></tr></thead><tbody><tr><td style="text-align:left;">convert(type,val)</td><td style="text-align:left;">将val转换为type类型</td><td style="text-align:left;">convert(date, &#39;2018-12-30&#39;)</td></tr><tr><td style="text-align:left;">cast(val as type)</td><td style="text-align:left;">同上</td><td style="text-align:left;">cast(&#39;2018-12-30&#39; as date)</td></tr><tr><td style="text-align:left;">convert(varchar,dateval,fmt)</td><td style="text-align:left;">将日期转换为对应格式</td><td style="text-align:left;">select convert(varchar, getdate(), 120)</td></tr><tr><td style="text-align:left;">format(val,fmt)</td><td style="text-align:left;">将val转换为fmt格式</td><td style="text-align:left;">format(getdate(),&#39;yyyy/MM/dd&#39;)</td></tr></tbody></table><h3 id="_1-2-2-字符串操作" tabindex="-1"><a class="header-anchor" href="#_1-2-2-字符串操作"><span>1.2.2 字符串操作</span></a></h3><table><thead><tr><th style="text-align:left;">方法名</th><th style="text-align:left;">作用</th><th style="text-align:left;">示例</th></tr></thead><tbody><tr><td style="text-align:left;">ltrim(val)</td><td style="text-align:left;">去除val左侧空格</td><td style="text-align:left;">ltrim(&#39; abcde&#39;)</td></tr><tr><td style="text-align:left;">rtrim(val)</td><td style="text-align:left;">去除val右侧空格</td><td style="text-align:left;">rtrim(&#39;abcde &#39;)</td></tr><tr><td style="text-align:left;">len(val)</td><td style="text-align:left;">计算字符串长度，汉字算一个</td><td style="text-align:left;">len(&#39;hello&#39;)</td></tr><tr><td style="text-align:left;">isnull(val1,val2)</td><td style="text-align:left;">如果va1是null,返回val2</td><td style="text-align:left;">isnull(null,&#39;isnull&#39;)</td></tr><tr><td style="text-align:left;">concat(varl1,val2)</td><td style="text-align:left;">拼接val1和val2</td><td style="text-align:left;">concat(&#39;a&#39;,&#39;b&#39;)</td></tr><tr><td style="text-align:left;">stuff(src,addr,len,str)</td><td style="text-align:left;">在src上从addr位置上(从1开始)删除len长度的字符，并替换成str</td><td style="text-align:left;">stuff(&#39;abcde&#39;,1,2,&#39;1234&#39;)</td></tr><tr><td style="text-align:left;">replace(src,dest,str)</td><td style="text-align:left;">将src中的dest全部替换为str</td><td style="text-align:left;">replace(&#39;abcde&#39;,&#39;a&#39;,&#39;w&#39;)</td></tr><tr><td style="text-align:left;">replicate(src,val)</td><td style="text-align:left;">将src重复val次输出</td><td style="text-align:left;">replicate(&#39;0&#39;, 10-len(&#39;123&#39;))+&#39;123&#39;</td></tr><tr><td style="text-align:left;">charindex(str,src,addr)</td><td style="text-align:left;">从addr位置上查找str在src中的位置</td><td style="text-align:left;">charindex(&#39;Abc&#39;,&#39;abcdef&#39;,0)</td></tr><tr><td style="text-align:left;">patindex(str,src)</td><td style="text-align:left;">从src中查找str,str可以是模糊查询形式</td><td style="text-align:left;">patindex(&#39;abc%&#39;,&#39;abcdef&#39;)</td></tr><tr><td style="text-align:left;">substring(src,addr,len)</td><td style="text-align:left;">从src第addr开始，截取len长度</td><td style="text-align:left;">substring(&#39;abcdef&#39;,1,2)</td></tr></tbody></table><blockquote><p><strong>P.S.:</strong></p></blockquote><ol><li>sql server没有trim方法可以使用ltrim(rtrim(val))替换</li><li>replicate中的例子是左补0的方法</li><li>charindex支持大小写敏感，只需要在src后加上COLLATE Latin1_General_CS_AS</li><li>patindex如果str不包含%，则逻辑就等是判断src和str是否相同，返回1。 <code>select patindex(&#39;%bc%&#39;,&#39;abcdef&#39;)</code>返回值为2。表中示例返回为1</li><li>方法的调用使用select [function(a,b,c...)] 形式。</li></ol><h3 id="_1-2-3-日期操作" tabindex="-1"><a class="header-anchor" href="#_1-2-3-日期操作"><span>1.2.3 日期操作</span></a></h3><table><thead><tr><th style="text-align:left;">方法名</th><th style="text-align:left;">作用</th><th style="text-align:left;">示例</th></tr></thead><tbody><tr><td style="text-align:left;">getdate()</td><td style="text-align:left;">获取当前时间</td><td style="text-align:left;">getdate()</td></tr><tr><td style="text-align:left;">datediff(type,start,end)</td><td style="text-align:left;">计算start,end之间的type数量，type可为year,day,month...</td><td style="text-align:left;">datediff(day,&#39;2018-12-30&#39;,&#39;2019-12-30&#39;)</td></tr><tr><td style="text-align:left;">dateadd(type,len,src)</td><td style="text-align:left;">在src上增加len个type，type同上，结果为datetime类型</td><td style="text-align:left;">dateadd(month,2,&#39;2018-12-15&#39;)</td></tr><tr><td style="text-align:left;">datename(type,src)</td><td style="text-align:left;">指定日期的指定日期部分的字符串</td><td style="text-align:left;">datename(weekday, &#39;2018-12-30&#39;)</td></tr><tr><td style="text-align:left;">datepart(type,src)</td><td style="text-align:left;">指定日期的指定日期部分的整数</td><td style="text-align:left;">datepart(month, &#39;2018-12-30&#39;)</td></tr></tbody></table><blockquote><p><strong>P.S.:</strong><a href="https://www.cnblogs.com/luna-hehe/p/8191873.html" target="_blank" rel="noopener noreferrer">datename和datepart的使用</a></p></blockquote><h3 id="_1-2-4-数字操作" tabindex="-1"><a class="header-anchor" href="#_1-2-4-数字操作"><span>1.2.4 数字操作</span></a></h3><table><thead><tr><th style="text-align:left;">方法名</th><th style="text-align:left;">作用</th><th style="text-align:left;">示例</th></tr></thead><tbody><tr><td style="text-align:left;">celling(val)</td><td style="text-align:left;">向上取整</td><td style="text-align:left;">celling(1.2)</td></tr><tr><td style="text-align:left;">floor(val)</td><td style="text-align:left;">向下取整</td><td style="text-align:left;">floor(1.5)</td></tr><tr><td style="text-align:left;">round(val,len)</td><td style="text-align:left;">四舍五入精确小数点后len位</td><td style="text-align:left;">round(123.4232,3)</td></tr><tr><td style="text-align:left;">power(val,pow)</td><td style="text-align:left;">val的pow次幂</td><td style="text-align:left;">power(2,10)</td></tr></tbody></table><h2 id="_1-3-数据库操作" tabindex="-1"><a class="header-anchor" href="#_1-3-数据库操作"><span>1.3 数据库操作</span></a></h2><h3 id="_1-3-1-约束" tabindex="-1"><a class="header-anchor" href="#_1-3-1-约束"><span>1.3.1 约束</span></a></h3><blockquote><p>-- 添加主键约束 alter table worker add constraint PK_code primary key(workcode); -- 添加唯一约束 alter table worker add constraint UNI_code unique (workcode); -- 添加默认约束 alter table worker add constraint DEF_note default &#39;this note should ....&#39; for note1; -- 添加检查约束 alter table worker add constraint CHK_note check(len(note1)&gt;10) -- 添加外键约束 alter table worker add constraint FOR_note foreign key(comcode) references com(comcode) -- 删除约束 alter table worker drop constraint DEF_note;</p></blockquote><h3 id="_1-3-2-索引" tabindex="-1"><a class="header-anchor" href="#_1-3-2-索引"><span>1.3.2 索引</span></a></h3><blockquote><p>create unique index worker_index on worker (workcode asc) create clustered index workernote_index on worker(note1) create nonclustered index com_index on com(comname)</p></blockquote><p><strong>P.S.:</strong> 一个表只能有一个聚集索引.</p><p>可以添加的参数: WITH ( --用于指定索引中间级中每个页（节点）上保持开放的空间 PAD_INDEX = ON --用于指定在创建索引时，每个索引页的数据占索引页大小的百分 比，fillfactor的值为1到100 , FILLFACTOR = 50 --用于指定过期的索引统计不会自动重新计算 , STATISTICS_NORECOMPUTE = OFF --用于指定创建索引时的中间排序结果将存储在 tempdb 数据库中 , SORT_IN_TEMPDB = OFF --用于控制当往包含于一个唯一聚集索引中的列中插入重复数据时SQL Server 所作的反应。 , IGNORE_DUP_KEY = ON --用于指定应删除并重新创建已命名的先前存在的聚集索引或者非聚集索引。 , DROP_EXISTING = OFF --指定在索引操作期间基础表和关联的索引是否可用于查询和数据修改操作。 , ONLINE = OFF --访问索引时允许行锁。 , ALLOW_ROW_LOCKS = ON --访问索引时允许页锁。 , ALLOW_PAGE_LOCKS = ON )</p><p>链接: <a href="https://www.cnblogs.com/knowledgesea/p/3672099.html" target="_blank" rel="noopener noreferrer">关于索引的高级使用</a></p><h3 id="_1-3-3-序列" tabindex="-1"><a class="header-anchor" href="#_1-3-3-序列"><span>1.3.3 序列</span></a></h3><blockquote><p>--创建序列 create sequence [SEQNAME] as decimal minvalue 1 maxvalue 999999999999 start with 1 increment by 1 no cache --获取序列的下一个值 select next value for [SEQNAME]</p></blockquote><h3 id="_1-3-4-函数" tabindex="-1"><a class="header-anchor" href="#_1-3-4-函数"><span>1.3.4 函数</span></a></h3><ul><li>表值函数<div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>create function FUNCNAME (</span></span>
<span class="line"><span>--指定变量</span></span>
<span class="line"><span>@var1 varchar(10)</span></span>
<span class="line"><span>, ...</span></span>
<span class="line"><span>)</span></span>
<span class="line"><span>--指定返回类型</span></span>
<span class="line"><span>returns varchar(10)</span></span>
<span class="line"><span>begin</span></span>
<span class="line"><span>  --声明变量</span></span>
<span class="line"><span>  declare @var2 int</span></span>
<span class="line"><span>  --赋值的时候使用set</span></span>
<span class="line"><span>  set @var2 = (select age from user where usercode=&#39;000001&#39;);</span></span>
<span class="line"><span>  --如果查询数据库则可简化位</span></span>
<span class="line"><span>  select @var2 = age from .....</span></span>
<span class="line"><span>  --返回</span></span>
<span class="line"><span>  return @var2</span></span>
<span class="line"><span>end</span></span>
<span class="line"><span>--执行函数的方法</span></span>
<span class="line"><span>select FUNCNAME(&#39;a&#39;)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>内联标值函数<div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>create function FUNC_UserTab_1</span></span>
<span class="line"><span>(</span></span>
<span class="line"><span>    @codetype varchar(10)</span></span>
<span class="line"><span>)</span></span>
<span class="line"><span>returns table</span></span>
<span class="line"><span>as</span></span>
<span class="line"><span>return (select * from sys_code_mst where codetype=@codetype)</span></span>
<span class="line"><span>-- 查询结果为一张表，所以使用查表法</span></span>
<span class="line"><span>select * from FUNC_UserTab_1(&#39;salechnl&#39;)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>多语句表值函数<div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>create function selectSMSInfo(</span></span>
<span class="line"><span>	@othersign varchar(10)</span></span>
<span class="line"><span>)</span></span>
<span class="line"><span>returns @smsinfo TABLE (</span></span>
<span class="line"><span>	url varchar(100) not null</span></span>
<span class="line"><span>	, username varchar(20) not null</span></span>
<span class="line"><span>	, password varchar(20) not null</span></span>
<span class="line"><span>	, msgtype varchar(10) not null</span></span>
<span class="line"><span>	, encode varchar(10)</span></span>
<span class="line"><span>)</span></span>
<span class="line"><span>BEGIN</span></span>
<span class="line"><span>	DECLARE @url varchar(100)</span></span>
<span class="line"><span>	DECLARE @username varchar(20)</span></span>
<span class="line"><span>	DECLARE @password varchar(20)</span></span>
<span class="line"><span>	DECLARE @msgtype varchar(10)</span></span>
<span class="line"><span>	DECLARE @encode varchar(10)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>	SET @url = (select codename from sys_code_mst where codetype=&#39;sms&#39; and othersign = @othersign and code=&#39;SMSUrl&#39;)</span></span>
<span class="line"><span>	SET @username = (select codename from sys_code_mst where codetype=&#39;sms&#39; and othersign = @othersign and code=&#39;username&#39;)</span></span>
<span class="line"><span>	SET @password = (select codename from sys_code_mst where codetype=&#39;sms&#39; and othersign = @othersign and code=&#39;password&#39;)</span></span>
<span class="line"><span>	SET @msgtype = (select codename from sys_code_mst where codetype=&#39;sms&#39; and othersign = @othersign and code=&#39;msgtype&#39;)</span></span>
<span class="line"><span>	SET @encode = (select codename from sys_code_mst where codetype=&#39;sms&#39; and othersign = @othersign and code=&#39;encode&#39;)</span></span>
<span class="line"><span>	insert into @smsinfo(url, username, password, msgtype, encode) values(@url, @username, @password, @msgtype, @encode);</span></span>
<span class="line"><span>	RETURN</span></span>
<span class="line"><span>END</span></span>
<span class="line"><span>--调用方法,可以认为拼出一张表</span></span>
<span class="line"><span>select * from selectSMSInfo(&#39;a&#39;)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_1-3-5-存储过程" tabindex="-1"><a class="header-anchor" href="#_1-3-5-存储过程"><span>1.3.5 存储过程</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>CREATE PROCEDURE addtest</span></span>
<span class="line"><span>  @a int</span></span>
<span class="line"><span>  , @b int</span></span>
<span class="line"><span>  , @result int output</span></span>
<span class="line"><span>AS</span></span>
<span class="line"><span>BEGIN</span></span>
<span class="line"><span>  SET @result = @a+@b;</span></span>
<span class="line"><span>  return @result;</span></span>
<span class="line"><span>END</span></span>
<span class="line"><span></span></span>
<span class="line"><span>-- 调用</span></span>
<span class="line"><span>-- 注意output類型的參數可以不用加return</span></span>
<span class="line"><span>-- 有return可以不用加output</span></span>
<span class="line"><span>declare @res1 int</span></span>
<span class="line"><span>declare @res2 int</span></span>
<span class="line"><span>EXECUTE @res2 = dbo.addtest 1,2,@res1 output</span></span>
<span class="line"><span>print @res1</span></span>
<span class="line"><span>print @res2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-3-6-视图" tabindex="-1"><a class="header-anchor" href="#_1-3-6-视图"><span>1.3.6 视图</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>create view worker_view as select * from worker;</span></span>
<span class="line"><span>select * from worker_view;</span></span>
<span class="line"><span>drop view view_worker</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>链接：<a href="https://www.cnblogs.com/Brambling/p/6731386.html" target="_blank" rel="noopener noreferrer">视图</a></p><h3 id="_1-3-7-触发器" tabindex="-1"><a class="header-anchor" href="#_1-3-7-触发器"><span>1.3.7 触发器</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>create trigger worktrigger on worker</span></span>
<span class="line"><span>after delete as</span></span>
<span class="line"><span>begin</span></span>
<span class="line"><span>   insert into backuptable values(&#39;001&#39;, &#39;smith&#39;, getdate())</span></span>
<span class="line"><span>end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>P.S.:</strong> 当对worker进行删除操作后就会insert一条数据. 触发器可以加在update insert delete 操作上 sql server 有两种触发器instead of和after前者表示不执行预期操作而是执行触发器.</p><h3 id="_1-3-8-游标" tabindex="-1"><a class="header-anchor" href="#_1-3-8-游标"><span>1.3.8 游标</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>  declare @tempval varchar(10);</span></span>
<span class="line"><span>  declare cursorname for select columnname from tablename;</span></span>
<span class="line"><span>  open cursorname;</span></span>
<span class="line"><span>  fetch next from cursorname into @tempname;</span></span>
<span class="line"><span>  while @@fetch_status=0</span></span>
<span class="line"><span>    begin</span></span>
<span class="line"><span>      ........</span></span>
<span class="line"><span>    end</span></span>
<span class="line"><span>  close cursorname;</span></span>
<span class="line"><span>  deallocate cursorname;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-3-9-事务" tabindex="-1"><a class="header-anchor" href="#_1-3-9-事务"><span>1.3.9 事务</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>--定义变量，用于累计事务执行过程中的错误</span></span>
<span class="line"><span>declare @errorSum int</span></span>
<span class="line"><span>set @errorSum =0</span></span>
<span class="line"><span>begin transaction tran1</span></span>
<span class="line"><span>  begin</span></span>
<span class="line"><span>      insert into worker(workcode, workname) values(&#39;002&#39;, &#39;nansy&#39;)</span></span>
<span class="line"><span>      set @errorSum=@errorSum+@@ERROR</span></span>
<span class="line"><span>      print &#39;a&#39;+convert(varchar,@errorSum)</span></span>
<span class="line"><span>      insert into worker(workcode,workname) values(&#39;001&#39;, &#39;hyes&#39;)</span></span>
<span class="line"><span>      insert into worker(workcode,workname) values(&#39;002&#39;, &#39;mtys&#39;)</span></span>
<span class="line"><span>      set @errorSum = @errorSum+@@ERROR</span></span>
<span class="line"><span>      print &#39;b&#39;+convert(varchar,@errorSum)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      if @errorSum&gt;0</span></span>
<span class="line"><span>        begin</span></span>
<span class="line"><span>          rollback transaction tran1</span></span>
<span class="line"><span>        end</span></span>
<span class="line"><span>      else</span></span>
<span class="line"><span>        begin</span></span>
<span class="line"><span>          commit transaction tran1</span></span>
<span class="line"><span>        end</span></span>
<span class="line"><span>  end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果数据库中设置了workcode为主键, 当我们第二次插入002时,会出现主键重复,该语句与事务中的语句均回滚.</p><h3 id="_1-3-10-异常" tabindex="-1"><a class="header-anchor" href="#_1-3-10-异常"><span>1.3.10 异常</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>BEGIN TRY</span></span>
<span class="line"><span> declare @res int</span></span>
<span class="line"><span> set @res=5/0;</span></span>
<span class="line"><span>END TRY</span></span>
<span class="line"><span>BEGIN CATCH</span></span>
<span class="line"><span> --返回错误号。</span></span>
<span class="line"><span> select ERROR_NUMBER();</span></span>
<span class="line"><span> --返回严重性。</span></span>
<span class="line"><span> select ERROR_SEVERITY();</span></span>
<span class="line"><span> --返回错误状态号。</span></span>
<span class="line"><span> select ERROR_STATE();</span></span>
<span class="line"><span> --返回出现错误的存储过程或触发器的名称。</span></span>
<span class="line"><span> select ERROR_PROCEDURE()</span></span>
<span class="line"><span> --返回导致错误的例程中的行号。</span></span>
<span class="line"><span> select ERROR_LINE();</span></span>
<span class="line"><span> --返回错误消息的完整文本。 该文本可包括任何可替换参数所提供的值，如长度、对象名或时间。</span></span>
<span class="line"><span> select ERROR_MESSAGE();</span></span>
<span class="line"><span>END CATCH</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-3-11-其他" tabindex="-1"><a class="header-anchor" href="#_1-3-11-其他"><span>1.3.11 其他</span></a></h3><blockquote><p><strong>添加、删除字段</strong> alter table info add note1 varchar(100); alter table info drop column note1; <strong>删除表的内容</strong> truncate table worker <strong>查询分页</strong> select top number|percent * from tablename sql server要实现查询从第几条到第几条记录. 可以使用如下方法:</p></blockquote><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>-- 查询第6到15条记录</span></span>
<span class="line"><span>select top 10 agntend.agentcode, agntend.sex from uwca.dbo.uw_nb_agent agntend where agntend.agentcode not in (</span></span>
<span class="line"><span>select top 5 agntstart.agentcode from uwca.dbo.uw_nb_agent agntstart</span></span>
<span class="line"><span>)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用rownumer也可以实现分页:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>select ROW_NUMBER() over(order by agentcode) &#39;seq&#39;, agentcode, sex into temp from uwca.dbo.uw_nb_agent</span></span>
<span class="line"><span>select * from temp where seq between 6 and 15;</span></span>
<span class="line"><span>drop table temp;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,49))])}const v=n(d,[["render",r]]),h=JSON.parse('{"path":"/posts/database/SqlServer-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C.html","title":"sql server 数据库","lang":"en-US","frontmatter":{"isOriginal":true,"title":"sql server 数据库","date":"2018-11-13T00:00:00.000Z","tag":["sql server","sql语法"],"category":"database","description":"sql server数据库的基本数据类型以及相关ddl dml的使用","sticky":false,"timeline":true,"article":true,"star":false,"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"sql server 数据库\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2018-11-13T00:00:00.000Z\\",\\"dateModified\\":\\"2024-12-31T08:40:08.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"我小叮当、\\",\\"url\\":\\"https://nikolazhang.github.io\\"}]}"],["meta",{"property":"og:url","content":"https://nikolazhang.github.io/posts/database/SqlServer-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C.html"}],["meta",{"property":"og:title","content":"sql server 数据库"}],["meta",{"property":"og:description","content":"sql server数据库的基本数据类型以及相关ddl dml的使用"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-12-31T08:40:08.000Z"}],["meta",{"property":"article:tag","content":"sql语法"}],["meta",{"property":"article:tag","content":"sql server"}],["meta",{"property":"article:published_time","content":"2018-11-13T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-12-31T08:40:08.000Z"}]]},"git":{"createdTime":1665625617000,"updatedTime":1735634408000,"contributors":[{"name":"zhangxu","username":"zhangxu","email":"nikolazhang@163.com","commits":6,"url":"https://github.com/zhangxu"},{"name":"nikola","username":"nikola","email":"nikolazhang@163.com","commits":1,"url":"https://github.com/nikola"},{"name":"我小叮当","username":"","email":"nikolazhang@163.com","commits":1}]},"readingTime":{"minutes":7.76,"words":2328},"filePathRelative":"posts/database/SqlServer-数据库相关操作.md"}');export{v as comp,h as data};
