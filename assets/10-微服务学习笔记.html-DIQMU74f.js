import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as e,a as s,o as t}from"./app-CKGbbdi4.js";const n="/images/article/181202/serverconfig.png",l="/images/article/181202/eurekainstance.png",r={};function h(d,i){return t(),e("div",null,[...i[0]||(i[0]=[s('<h2 id="_1-eureka服务治理框架" tabindex="-1"><a class="header-anchor" href="#_1-eureka服务治理框架"><span>1 Eureka服务治理框架</span></a></h2><blockquote><p>⚠️ <strong>重要提示：Eureka已进入维护模式</strong> 当前Spring Cloud官方推荐使用Nacos作为服务注册与发现中心，替代Netflix Eureka。 本文内容仅作为Eureka技术参考，实际项目建议使用Nacos。</p></blockquote><h3 id="_1-1-eureka服务治理基础框架的三个核心要素" tabindex="-1"><a class="header-anchor" href="#_1-1-eureka服务治理基础框架的三个核心要素"><span>1.1 Eureka服务治理基础框架的三个核心要素</span></a></h3><ul><li>服务注册中心</li></ul><blockquote><p>Eureka提供的服务端，用于提供服务与发现。</p></blockquote><ul><li>服务提供者</li></ul><blockquote><p>提供服务的应用，可以是一切遵循Eureka通讯机制的应用（不限于springboot）。它将自己提供的服务注册到Eureka。</p></blockquote><ul><li>服务消费者</li></ul><blockquote><p>从服务注册中心获取服务列表，从而使消费者可以知道去何处调用需要的服务。可以通过ribbon和feign实现服务消费。</p></blockquote><h3 id="_1-2-服务治理机制" tabindex="-1"><a class="header-anchor" href="#_1-2-服务治理机制"><span>1.2 服务治理机制</span></a></h3><blockquote><ul><li>服务注册中心1,2相互注册形成高可用集群。</li></ul></blockquote><ul><li>服务提供者注册服务到注册中心。</li><li>服务消费者同样指向注册中心。</li></ul><h4 id="_1-2-1服务提供者" tabindex="-1"><a class="header-anchor" href="#_1-2-1服务提供者"><span>1.2.1服务提供者</span></a></h4><ul><li>服务注册 服务提供者在启动时会通过发送REST请求的方式将自己注册到Eureka Server上，同时带上自身服务的元数据信息。 Eureka Server接收到这个REST请求后，将元数据信息存储在一个双层结构Map中。第一层key是服务名，第二层key是具体服务的实例名。 <code>eureka.client.register-with-eureka=true</code> 启动注册操作。</li><li>服务同步 服务提供者虽然会在不同的注册中心注册，但是当服务注册中心会转发请求到与其相连的其他注册中心，从而实现注册中心间的服务同步。通过服务同步，服务提供者的服务信息就可以通多服务注册中心的任一台获取到。</li><li>服务续约 服务注册完成后，服务提供者会维护一个心跳，防止EurekaServer“剔除任务”。 <code>eureka.instance.lease-renewal-interval-in-seconds=30</code> 设置服务续约任务的调用间隔。 <code>eureka.instance.lease-expiration-duration-in-seconds=90</code> 定义服务失效时间。</li></ul><h4 id="_1-2-2-服务消费者" tabindex="-1"><a class="header-anchor" href="#_1-2-2-服务消费者"><span>1.2.2 服务消费者</span></a></h4><ul><li><p>获取服务 当我们启动服务消费者的时候，它会发送一个REST请求给服务注册中心，来获取注册的服务清单。EurekaServer会维护一份只读的服务清单返回给客户端，同时该缓存清单会每隔30秒更新一次。 客户端设置 <code>eureka.client.fetch-register=true</code>（虽然这是默认的） <code>eureka.client.fetch-register-interval-seconds=30</code>设置缓存清单更新时间。</p></li><li><p>服务调用 消费者获取服务清单后，通过服务名可以获取：服务实例名和该实例的元数据信息。 在Ribbon中通过轮询的方式进行调用实例，从而实现客户端的负载均衡。 进行服务调用时优先访问同处一个zone中的服务提供方。若访问不到则访问其他的zone。【每一个客户端对应一个region和一个zone】</p></li><li><p>服务下线 当服务实例进行正常关闭时，会触发一个服务下线的REST请求给EurekaServer，服务注册中心收到请求后，将该服务状态设置为下线<code>down</code>（上线为up）。并把下线事件传播出去。</p></li></ul><h4 id="_1-2-3-服务注册中心" tabindex="-1"><a class="header-anchor" href="#_1-2-3-服务注册中心"><span>1.2.3 服务注册中心</span></a></h4><ul><li>失效剔除 当服务实例非正常下线，服务注册中心未收到下线请求。EurekaServer的定时任务会将清单中超时没有续约的服务剔除。</li><li>自我保护 EMERGENCY! EUREKA MAY BE INCORRECTLY CLAIMING INSTANCES ARE UP WHEN THEY&#39;RE NOT. RENEWALS ARE LESSER THAN THRESHOLD AND HENCE THE INSTANCES ARE NOT BEING EXPIRED JUST TO BE SAFE. 本地调试时基本会在界面看到这条信息。这就是触发了EurekaServer的自我保护机制。EurekaServer在运行期间，会统计心跳失败比例在15分钟内是否低于85%。eureka会将当前实例信息保护起来，不让其过期。 使用<code>eureka.server.enable-self-preservation=false</code>来关闭保护机制。</li></ul><h3 id="_1-3-配置" tabindex="-1"><a class="header-anchor" href="#_1-3-配置"><span>1.3 配置</span></a></h3><p>以上所有的应用都可以视为Eureka服务治理体系中的客户端。故，eureka客户端的配置包含两部分：</p><blockquote><ul><li>服务注册相关配置：服务注册中心地址、服务获取间隔时间、可用区域等</li><li>服务实例相关的配置信息：服务实例名称、IP地址、端口号、健康检查路径等。</li></ul></blockquote><h4 id="_1-3-1-服务注册类配置" tabindex="-1"><a class="header-anchor" href="#_1-3-1-服务注册类配置"><span>1.3.1 服务注册类配置</span></a></h4><p>可以查看<code>org.springframework.cloud.netflix.eureka.EurekaClientConfigBean</code>所有的配置信息都以eureka.client为前缀。</p><ul><li><p>指定注册中心 <code>eureka.client.serviceUrl.defaultZone=http....</code> 配置多个注册中心使用逗号分隔。 <code>http://&lt;username&gt;:&lt;password&gt;@ip:port/...</code>使用安全校验信息。 <code>eureka.client.enable=true</code> 启用Eureka客户端 <img src="'+n+'" alt="其他配置" loading="lazy"></p></li><li><p><strong>服务实例类配置</strong> 可以查看<code>org.springframework.cloud.netflix.eureka.EurekaInstanceConfigBean</code>所有的配置信息都以eureka.instance为前缀。</p><ul><li>元数据</li></ul><blockquote><p>元数据：Eureka客户端在向注册中心发送注册请求时，用来描述自身服务信息的对象。</p></blockquote><p>标准化元数据<code>eureka.instance.&lt;properties&gt;=&lt;value&gt;</code> 自定义元数据<code>eureka.instance.metedataMap.&lt;key&gt;=&lt;value&gt;</code></p><ul><li><p>实例名配置 同一主机启动多实例时的默认配置规则： <code>${spring.cloud.client.hostname}:${spring.application.name}:${spring.application.instance_id:${server.port}}</code> 对于实例的命名规则可以使用eureka.instance.instanceId参数进行配置。 设置随机端口：<code>server.port=0</code>或者 <code>server.port=${random.int[10000,19999]}</code> 虽然端口名不同但是实例名还是相同的，需要使用下面的方法设置不同的实例名： <code>eureka.instance.instanceId=${spring.application.name}:${random.int}</code></p></li><li><p>端点配置 当我们为应用设置了context-path时，<code>management.context-path=/hello</code>，监控端点都应该加上这个前缀。需要变更actuator模块的访问的路径。 <code>eureka.instance.statusPageUrlPath=${management.context-path}/info</code><code>eureka.instance.healthCheckUrlPath=${management.context-path}/health</code> 使用绝对路径方式： <code>eureka.instance.healthCheckUrl=https://${eureka.instance.hostname}/health</code><code>eureka.instance.statusPageUrl=https://${eureka.instance.hostname}/info</code><code>eureka.instance.homePageUrl=https://${eureka.instance.hostname}/</code></p></li><li><p>健康监测 当服务不能正常提供时，比如服务所依赖的外部资源出现问题时，此时心跳还是在运行，客户端依旧可以使用非正常服务。这是不合理的。 因此需要更加健全的健康状态维护。方法如下： <em>首先在pom xml中引入actuator模块依赖</em><em>配置参数<code>eureka.client.healthcheck.enable=true</code></em></p></li><li><p>其他配置 <img src="'+l+`" alt="其他配置" loading="lazy"></p></li></ul></li></ul><h3 id="_1-4-跨平台支持" tabindex="-1"><a class="header-anchor" href="#_1-4-跨平台支持"><span>1.4 跨平台支持</span></a></h3><p>Eureka的通信机制使用HTTP的REST接口实现，这也是Eureka同其他服务注册工具的一个关键不同点。HTTP是平台无关的，虽然Eureka Server通过java实现，但是其下微服务应用不限于使用java开发。</p><h4 id="_1-4-1-通信协议" tabindex="-1"><a class="header-anchor" href="#_1-4-1-通信协议"><span>1.4.1 通信协议</span></a></h4><blockquote><p>Eureka使用Jersey和XStream配合JSON作为servlet和client之间的通讯协议。也可以选择实现自己的协议来代替。</p></blockquote><hr><h2 id="_2-nacos替代方案介绍" tabindex="-1"><a class="header-anchor" href="#_2-nacos替代方案介绍"><span>2 Nacos替代方案介绍</span></a></h2><h3 id="_2-1-nacos与eureka的对比" tabindex="-1"><a class="header-anchor" href="#_2-1-nacos与eureka的对比"><span>2.1 Nacos与Eureka的对比</span></a></h3><table><thead><tr><th>特性</th><th>Eureka</th><th>Nacos</th></tr></thead><tbody><tr><td>开发维护</td><td>Netflix（已进入维护模式）</td><td>阿里巴巴（活跃维护）</td></tr><tr><td>一致性协议</td><td>AP</td><td>同时支持AP和CP</td></tr><tr><td>配置中心</td><td>不支持</td><td>支持</td></tr><tr><td>动态DNS</td><td>不支持</td><td>支持</td></tr><tr><td>服务健康检查</td><td>客户端心跳</td><td>TCP/HTTP/MYSQL/自定义</td></tr><tr><td>性能</td><td>一般</td><td>更高</td></tr><tr><td>扩展性</td><td>一般</td><td>更好</td></tr><tr><td>管理界面</td><td>基本</td><td>丰富</td></tr></tbody></table><h3 id="_2-2-从eureka迁移到nacos的步骤" tabindex="-1"><a class="header-anchor" href="#_2-2-从eureka迁移到nacos的步骤"><span>2.2 从Eureka迁移到Nacos的步骤</span></a></h3><h4 id="_2-2-1-服务注册中心迁移" tabindex="-1"><a class="header-anchor" href="#_2-2-1-服务注册中心迁移"><span>2.2.1 服务注册中心迁移</span></a></h4><ol><li><p><strong>下载并启动Nacos Server</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 下载Nacos Server</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 访问：https://github.com/alibaba/nacos/releases</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启动Nacos（单机模式）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sh</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> startup.sh</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -m</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> standalone</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>客户端迁移</strong></p><p><strong>Step 1: 替换依赖</strong></p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-xml"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">&lt;!-- 移除Eureka依赖 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;org.springframework.cloud&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;spring-cloud-starter-netflix-eureka-client&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">&lt;!-- 添加Nacos依赖 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;com.alibaba.cloud&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Step 2: 更新配置文件</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 移除Eureka配置</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># eureka:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#   client:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#     serviceUrl:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#       defaultZone: http://localhost:8761/eureka/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 添加Nacos配置</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  cloud</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    nacos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      discovery</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        server-addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">localhost:8848</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Step 3: 启动类无需修改</strong></p><blockquote><p><code>@EnableDiscoveryClient</code>注解同时支持Eureka和Nacos</p></blockquote></li></ol><h3 id="_2-3-nacos额外功能" tabindex="-1"><a class="header-anchor" href="#_2-3-nacos额外功能"><span>2.3 Nacos额外功能</span></a></h3><ul><li><strong>配置中心功能</strong>：集中管理配置，支持热更新</li><li><strong>服务路由</strong>：支持基于权重的负载均衡和灰度发布</li><li><strong>服务降级</strong>：支持流量控制和服务降级</li><li><strong>动态DNS</strong>：支持自定义域名解析</li><li><strong>多环境支持</strong>：通过namespace实现环境隔离</li></ul>`,37)])])}const c=a(r,[["render",h]]),k=JSON.parse('{"path":"/posts/springcloud/10-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html","title":"微服务学习笔记（Eureka篇 - 已过时）","lang":"en-US","frontmatter":{"isOriginal":true,"title":"微服务学习笔记（Eureka篇 - 已过时）","date":"2018-12-02T00:00:00.000Z","icon":"code","update":"2024-01-01T00:00:00.000Z","tag":["eureka","nacos"],"category":"技术","description":"Eureka服务治理框架介绍（已过时，推荐使用Nacos）","sticky":false,"timeline":true,"article":true,"star":false,"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"微服务学习笔记（Eureka篇 - 已过时）\\",\\"image\\":[\\"https://nikolazhang.github.io/images/article/181202/serverconfig.png\\",\\"https://nikolazhang.github.io/images/article/181202/eurekainstance.png\\"],\\"datePublished\\":\\"2018-12-02T00:00:00.000Z\\",\\"dateModified\\":\\"2025-12-07T16:26:37.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"DewyYr、\\",\\"url\\":\\"https://nikolazhang.github.io\\"}]}"],["meta",{"property":"og:url","content":"https://nikolazhang.github.io/posts/springcloud/10-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html"}],["meta",{"property":"og:title","content":"微服务学习笔记（Eureka篇 - 已过时）"}],["meta",{"property":"og:description","content":"Eureka服务治理框架介绍（已过时，推荐使用Nacos）"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://nikolazhang.github.io/images/article/181202/serverconfig.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-12-07T16:26:37.000Z"}],["meta",{"property":"article:tag","content":"nacos"}],["meta",{"property":"article:tag","content":"eureka"}],["meta",{"property":"article:published_time","content":"2018-12-02T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-12-07T16:26:37.000Z"}]]},"git":{"createdTime":1665625617000,"updatedTime":1765124797000,"contributors":[{"name":"zhangxu","username":"zhangxu","email":"nikolazhang@163.com","commits":5,"url":"https://github.com/zhangxu"},{"name":"nikola","username":"nikola","email":"nikolazhang@163.com","commits":1,"url":"https://github.com/nikola"},{"name":"我小叮当","username":"","email":"nikolazhang@163.com","commits":3}]},"readingTime":{"minutes":6.83,"words":2048},"filePathRelative":"posts/springcloud/10-微服务学习笔记.md"}');export{c as comp,k as data};
