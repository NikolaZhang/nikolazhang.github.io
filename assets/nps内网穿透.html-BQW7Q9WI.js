import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,e,o as i}from"./app-tiuAdH6w.js";const p={};function l(t,n){return i(),a("div",null,[...n[0]||(n[0]=[e(`<blockquote><p>通过内网穿透我们可以在外网访问到内网设备，就好像内网设备拥有了公网ip一样。</p></blockquote><h2 id="环境" tabindex="-1"><a class="header-anchor" href="#环境"><span>环境</span></a></h2><p>服务端使用阿里云ubuntu服务器，客户端就是本地的win10pc</p><h2 id="服务端" tabindex="-1"><a class="header-anchor" href="#服务端"><span>服务端</span></a></h2><h3 id="安装服务端" tabindex="-1"><a class="header-anchor" href="#安装服务端"><span>安装服务端</span></a></h3><ol><li>从github的<a href="https://github.com/ehang-io/nps/releases" target="_blank" rel="noopener noreferrer">ehang-io/nps</a>中获取符合自己环境的发布包，这里我用的是<a href="https://github.com/ehang-io/nps/releases/download/v0.26.10/linux_amd64_server.tar.gz" target="_blank" rel="noopener noreferrer">linux_amd64_server</a></li><li>解压，<code>tar -zxvf linux_amd64_server.tar.gz</code></li><li>在<code>linux_amd64_server</code>目录下我们可以看到解压的文件。</li><li>需要注意的是直接修改此处的配置文件是无效的。运行时使用的配置文件目录为：<code>/etc/nps/conf/</code>。</li><li>我的配置为：</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>appname = nps</span></span>
<span class="line"><span>#Boot mode(dev|pro)</span></span>
<span class="line"><span>runmode = pro</span></span>
<span class="line"><span></span></span>
<span class="line"><span>##bridge</span></span>
<span class="line"><span>## 客户端与服务端连接方式kcp或tcp</span></span>
<span class="line"><span>bridge_type=tcp</span></span>
<span class="line"><span>## 服务端客户端通信端口，也就是说客户端通过访问服务端的这个端口可以进行连接</span></span>
<span class="line"><span>bridge_port=8024</span></span>
<span class="line"><span>bridge_ip=0.0.0.0</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Public password, which clients can use to connect to the server</span></span>
<span class="line"><span># After the connection, the server will be able to open relevant ports and parse related domain names according to its own configuration file.</span></span>
<span class="line"><span>## 客户端以配置文件模式启动时的密钥，设置为空表示关闭客户端配置文件连接模式</span></span>
<span class="line"><span>public_vkey=123123</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span># log level LevelEmergency-&gt;0  LevelAlert-&gt;1 LevelCritical-&gt;2 LevelError-&gt;3 LevelWarning-&gt;4 LevelNotice-&gt;5 LevelInformational-&gt;6 LevelDebug-&gt;7</span></span>
<span class="line"><span># 配置自己想要的日志级别以及日志文件目录</span></span>
<span class="line"><span>log_level=7</span></span>
<span class="line"><span>log_path=/home/nikola/app/nps-tool/nps.log</span></span>
<span class="line"><span></span></span>
<span class="line"><span># nps提供网页版的管理系统，此处为相关配置</span></span>
<span class="line"><span>#web</span></span>
<span class="line"><span># 网址可以为ip或者域名</span></span>
<span class="line"><span>web_host=xxx.xxxx.xxx</span></span>
<span class="line"><span># 登录nps的账号</span></span>
<span class="line"><span>web_username=xxxx</span></span>
<span class="line"><span>web_password=xxxx</span></span>
<span class="line"><span># 使用的端口 注意需要添加安全组</span></span>
<span class="line"><span>web_port=8888</span></span>
<span class="line"><span>web_ip=0.0.0.0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将上面的配置替换到<code>nps.conf</code>文件中 6. 使用<code>nps start</code>命令启动服务</p><h3 id="创建隧道和客户端" tabindex="-1"><a class="header-anchor" href="#创建隧道和客户端"><span>创建隧道和客户端</span></a></h3><ol><li>访问我们配置的web页面, 并使用用户名和密码登录。<br><img src="https://tech-nikola.nikolazhang.top/tools/nps/nps-login.png" alt="登录页面" loading="lazy"></li><li>点击左侧客户端，之后点击新增按钮。按照下图进行配置。唯一验证密钥可以不填写，由系统生成。<br><img src="https://tech-nikola.nikolazhang.top/tools/nps/nps-client.png" alt="配置信息" loading="lazy"></li><li>保存之后，回到客户端列表页面，在刚才新增的客户端上点击隧道。</li><li>按照下图配置隧道信息。客户端id为之前配置的客户端id可以在列表页面查看。服务端端口需要一个空闲端口。目标为本地的远程连接ip和端口（3389为默认的windows远程连接端口）。<br><img src="https://tech-nikola.nikolazhang.top/tools/nps/nps-suidao.png" alt="隧道信息" loading="lazy"></li></ol><h2 id="客户端" tabindex="-1"><a class="header-anchor" href="#客户端"><span>客户端</span></a></h2><h3 id="安装客户端" tabindex="-1"><a class="header-anchor" href="#安装客户端"><span>安装客户端</span></a></h3><p>从github的<a href="https://github.com/ehang-io/nps/releases" target="_blank" rel="noopener noreferrer">ehang-io/nps</a>中获取符合自己的发布包，这里我用的是<a href="https://github.com/ehang-io/nps/releases/download/v0.26.10/windows_amd64_client.tar.gz" target="_blank" rel="noopener noreferrer">windows_amd64_client</a></p><p>解压该压缩包。并进入解压目录，可以看到一个<code>npc.exe</code>文件，和一个<code>conf</code>配置文件目录。</p><p>推荐你将当前目录添加到环境变量中去。（具体方法是打开控制面板-&gt;系统-&gt;环境变量-&gt;在path下添加该目录）这样我们就可以在全局使用npc命令。</p><p>回到我们服务端的web页面，查看客户端列表的信息。可以看到下图位置的命令行。（<code>npc -server=localhost:8024 -vkey=xxxxxxxx -type=tcp</code>）</p><p>将其复制变将localhost改成上面服务器的ip。执行命令可以看到连接成功的日志提示。</p><figure><img src="https://tech-nikola.nikolazhang.top/tools/nps/nps-client-connect.png" alt="success" tabindex="0" loading="lazy"><figcaption>success</figcaption></figure><p>回到服务端的客户端列表页面，此时可以看到客户端已经在线了。</p><p><img src="https://tech-nikola.nikolazhang.top/tools/nps/nps-server-clients.png" alt="client-online" loading="lazy"><img src="https://tech-nikola.nikolazhang.top/tools/nps/nps-server-suidao.png" alt="suidao-online" loading="lazy"></p><h2 id="使用远程连接访问" tabindex="-1"><a class="header-anchor" href="#使用远程连接访问"><span>使用远程连接访问</span></a></h2><p>打开windows的远程连接功能。注意需要确保windows具有远程访问的功能，并且能正常使用，有些版本是被阉割的。（可以通过<a href="https://github.com/stascorp/rdpwrap/releases" target="_blank" rel="noopener noreferrer">修复工具</a>解决）</p><figure><img src="https://tech-nikola.nikolazhang.top/tools/nps/nps-win-remote.png" alt="windows" tabindex="0" loading="lazy"><figcaption>windows</figcaption></figure><p>输入远程电脑的账号密码就可以访问了。</p>`,24)])])}const c=s(p,[["render",l]]),d=JSON.parse('{"path":"/posts/tools/nps%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F.html","title":"通过nps访问内网pc","lang":"en-US","frontmatter":{"isOriginal":true,"title":"通过nps访问内网pc","date":"2021-06-25T00:00:00.000Z","tag":["nps","内网穿透","远程"],"category":"nps","description":"nps搭建内网穿透","sticky":false,"timeline":true,"article":true,"star":true,"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"通过nps访问内网pc\\",\\"image\\":[\\"https://tech-nikola.nikolazhang.top/tools/nps/nps-login.png\\",\\"https://tech-nikola.nikolazhang.top/tools/nps/nps-client.png\\",\\"https://tech-nikola.nikolazhang.top/tools/nps/nps-suidao.png\\",\\"https://tech-nikola.nikolazhang.top/tools/nps/nps-client-connect.png\\",\\"https://tech-nikola.nikolazhang.top/tools/nps/nps-server-clients.png\\",\\"https://tech-nikola.nikolazhang.top/tools/nps/nps-server-suidao.png\\",\\"https://tech-nikola.nikolazhang.top/tools/nps/nps-win-remote.png\\"],\\"datePublished\\":\\"2021-06-25T00:00:00.000Z\\",\\"dateModified\\":\\"2024-12-31T08:40:08.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"我小叮当、\\",\\"url\\":\\"https://nikolazhang.github.io\\"}]}"],["meta",{"property":"og:url","content":"https://nikolazhang.github.io/posts/tools/nps%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F.html"}],["meta",{"property":"og:title","content":"通过nps访问内网pc"}],["meta",{"property":"og:description","content":"nps搭建内网穿透"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://tech-nikola.nikolazhang.top/tools/nps/nps-login.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-12-31T08:40:08.000Z"}],["meta",{"property":"article:tag","content":"远程"}],["meta",{"property":"article:tag","content":"内网穿透"}],["meta",{"property":"article:tag","content":"nps"}],["meta",{"property":"article:published_time","content":"2021-06-25T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-12-31T08:40:08.000Z"}]]},"git":{"createdTime":1665625617000,"updatedTime":1735634408000,"contributors":[{"name":"zhangxu","username":"zhangxu","email":"nikolazhang@163.com","commits":7,"url":"https://github.com/zhangxu"},{"name":"nikola","username":"nikola","email":"nikolazhang@163.com","commits":1,"url":"https://github.com/nikola"},{"name":"我小叮当","username":"","email":"nikolazhang@163.com","commits":1}]},"readingTime":{"minutes":3.3,"words":991},"filePathRelative":"posts/tools/nps内网穿透.md"}');export{c as comp,d as data};
