import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as e,o as n}from"./app-DlxWugZU.js";const l={};function h(k,i){return n(),a("div",null,[...i[0]||(i[0]=[e(`<blockquote><p>平时开发总是离不开各种环境, 甚至在公司摸鱼学习有一个自己的环境, 回到家也有一套环境. 一个新的环境就要重新配置, 总是在解决相同的问题, 实在是索然无味. 如果你也有和我一样的痛点那么这篇文章可能会比较适合你.</p></blockquote><h2 id="思路" tabindex="-1"><a class="header-anchor" href="#思路"><span>思路</span></a></h2><p>使用docker进行环境和服务的部署. 本文章的解决方案已经开源到<a href="https://gitee.com/NikolaZhang/vm-config" target="_blank" rel="noopener noreferrer">gitee</a></p><h2 id="准备" tabindex="-1"><a class="header-anchor" href="#准备"><span>准备</span></a></h2><ol><li><p>拉取该仓库的配置到本地</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> clone</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://gitee.com/NikolaZhang/vm-config.git</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>安装docker</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 使用ubuntu</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker.io</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>拉取docker镜像</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pull</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> xxxxx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>你可能需要如下镜像:</p><ul><li>efak: <a href="http://registry.cn-shanghai.aliyuncs.com/nikola-docker/efak-nikola:1.0" target="_blank" rel="noopener noreferrer">registry.cn-shanghai.aliyuncs.com/nikola-docker/efak-nikola:1.0</a></li><li>kafka: <a href="http://registry.cn-shanghai.aliyuncs.com/nikola-docker/kafka-nikola" target="_blank" rel="noopener noreferrer">registry.cn-shanghai.aliyuncs.com/nikola-docker/kafka-nikola</a></li><li>zookeeper <a href="http://registry.cn-shanghai.aliyuncs.com/nikola-docker/zookeeper-nikola" target="_blank" rel="noopener noreferrer">registry.cn-shanghai.aliyuncs.com/nikola-docker/zookeeper-nikola</a></li><li>redis</li><li>mysql</li></ul></li><li><p>创建网络环境 为了隔离各个环境之前ip的差别, 最好使用自定义的名称进行隔离.</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> network</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> create</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nikola-net</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>通过nikola-net这个桥接网络, 容器可以通过各自的网络别名进行访问.<br> 运行容器时设置<code>--network nikola-net --network-alias=容器网络别名</code>即可</p></li><li><p>编辑环境配置 我们的环境配置有以下几种：</p><ul><li>环境变量文件：在vm-config根目录下的env_xxx这样的文件名</li><li>docker容器挂载的配置文件，配置文件目录需要在环境变量中配置</li></ul><p>注意环境中的配置参数,编辑后不是直接生效的, 需要执行<code>source xxx</code>才可以. 你需要什么环境的配置，直接source对应的文件即可</p></li></ol><h2 id="zookeeper部署" tabindex="-1"><a class="header-anchor" href="#zookeeper部署"><span>zookeeper部署</span></a></h2><p><code>vm-config/docker/zookeeper</code>目录下,<code>zookeeper.sh</code>为启动zookeeper容器的脚本. 直接执行即可.</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./zookeeper-1.sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>使用<code>docker ps</code>发现容器状态为<code>Up</code>, ok</p><h2 id="kafka-部署" tabindex="-1"><a class="header-anchor" href="#kafka-部署"><span>kafka 部署</span></a></h2><p>kafka的启动脚本在<code>vm-config/docker/kafka/</code>目录下. 注意执行之前需要配置环境信息</p><ol><li><p>使用<code>source 你的配置文件</code>, 使配置生效.</p></li><li><p>执行下面的脚本就可以启动kafka了</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./kafka-env.sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><h2 id="mysql部署" tabindex="-1"><a class="header-anchor" href="#mysql部署"><span>mysql部署</span></a></h2><p>执行下面的命令即可启动mysql</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./mysql-1.sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="efak-部署" tabindex="-1"><a class="header-anchor" href="#efak-部署"><span>efak 部署</span></a></h2><p>efak用于kafka的监控.它的启动需要依赖zookeeper,kafka,mysql 请检查容器状态, 确保以上环境启动正确.</p><ol><li>配置环境信息, 并使用source使配置生效 <code>vm-config</code>目录中的你的配置文件中需要配置: <ul><li><code>EFAK_LOG_FILE</code>: 为efak日志文件的全路径</li><li><code>EFAK_CONF_FILE</code>: 为2中你的配置文件的全路径</li></ul></li><li>执行<code>./efak.sh</code>即可启动efak</li><li>到你的浏览器中输入: 你的ip:8048即可 初始账号:admin 密码:123456</li></ol><h3 id="efak-docker镜像的构建" tabindex="-1"><a class="header-anchor" href="#efak-docker镜像的构建"><span>efak docker镜像的构建</span></a></h3><p>efak的镜像是通过程序包进行构建的, 以下为构建过程</p><ol><li><p>从<a href="http://download.kafka-eagle.org/" target="_blank" rel="noopener noreferrer">efak官网</a>下载efak程序包, 解压</p></li><li><p>编辑dockerfile</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  java:8</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">COPY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> efak-web-2.0.8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /home/efak</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ENV</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> KE_HOME=/home/efak</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">EXPOSE</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 8048</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 777</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /home/efak/</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">CMD</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;bash&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;-c&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/home/efak/bin/ke.sh start &amp;&amp; tail -f /dev/null&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>执行<code>docker build -t efak-nikola .</code>完成镜像构建.</p></li><li><p>docker tag efak-nikola <a href="http://registry.cn-shanghai.aliyuncs.com/nikola-docker/efak-nikola:%5Bversion%5D" target="_blank" rel="noopener noreferrer">registry.cn-shanghai.aliyuncs.com/nikola-docker/efak-nikola:[version]</a></p></li><li><p>docker push <a href="http://registry.cn-shanghai.aliyuncs.com/nikola-docker/efak-nikola:%5Bversion%5D" target="_blank" rel="noopener noreferrer">registry.cn-shanghai.aliyuncs.com/nikola-docker/efak-nikola:[version]</a></p></li></ol><p>p.s.: 4,5两步用于完成阿里云容器镜像推送</p><h2 id="redis部署" tabindex="-1"><a class="header-anchor" href="#redis部署"><span>redis部署</span></a></h2><p>执行如下命令:</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./redis-1.sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="外部访问" tabindex="-1"><a class="header-anchor" href="#外部访问"><span>外部访问</span></a></h2><p>当使用外部程序访问容器时, 比如kafka会出现kafka-1无法解析的问题, 需要在你的hosts文件中添加</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">虚拟机ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kafka-1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="部署脚本" tabindex="-1"><a class="header-anchor" href="#部署脚本"><span>部署脚本</span></a></h2><p>以efak的部署脚本为例:</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/bin/bash</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [ </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;x</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$EFAK_LOG_FILE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;x&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ]; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> please</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> source</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> env_xxx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> init</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> environment!</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  exit</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">fi</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">containerName</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">efak-web</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">shellPath</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dirname</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> $0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$shellPath</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/../../common/docker_container_remove.sh </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$containerName</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> efak-nikola</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$EFAK_LOG_FILE</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 8048:8048</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --restart=always</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    --name</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $containerName</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    --network</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nikola-net</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    --network-alias</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> efak-1</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    -v</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $EFAK_LOG_FILE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:/home/efak/logs/log.log</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    -v</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $EFAK_CONF_FILE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:/home/efak/conf/system-config.properties</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    registry.cn-shanghai.aliyuncs.com/nikola-docker/efak-nikola:1.0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>EFAK_LOG_FILE</code>: 为日志文件路径, 该文件会挂载到容器中作为日志输出, 该配置需要在你的变量配置文件中设置, 并且使用source命令使其生效. 脚本第一步是去检测该配置是否存在, 如果不存在表示没有执行过source命令.</p><p><code>docker_container_remove.sh</code>: 是容器移除的脚本. 该脚本会检测容器是否正在运行, 如果运行中则将其停止. 之后再将其删除, 以便下次重新创建.<br> 脚本具体内容见下:</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">containerName</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">$1</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 判断容器是否存在</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">containerExist</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ps </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">-a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> grep</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $containerName</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\`</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [ </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$containerExist</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ]; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 容器是否为运行状态</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 容器正在运行</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    containerStatus</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> container inspect </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$containerName</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --format=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;{{.State.Running}}&quot;\`</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [ </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$containerStatus</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;true&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ]; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stop</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $containerName</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 停止容器</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    fi</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 删除容器</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rm</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $containerName</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">fi</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 创建容器....</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>后面的是efak docker容器的创建命令, 大致内容如下:</p><ol><li>容器在后台运行</li><li>映射主机端口8048</li><li>容器会自动重启</li><li>容器名称为<code>efak-web</code></li><li>使用<code>nikola-net</code>网络, 在该网络下使用efak-1可以访问容器</li><li>挂载日志和配置文件</li><li>指定镜像</li></ol><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h2><ol><li>首先source你的环境变量(如果需要的话)</li><li>修改容器配置文件(如果需要的话)</li><li>创建网络 docker network create nikola-net</li><li>执行容器启动脚本</li><li>外部环境配置hosts</li></ol><p>像zookeeper mysql redis kafka 你只要执行第3,4步即可,<br> efak你需要执行第1,3,4步(如果需要改配置第2步也不可少)</p>`,39)])])}const p=s(l,[["render",h]]),d=JSON.parse('{"path":"/posts/vm/01-%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE.html","title":"虚拟机环境配置","lang":"en-US","frontmatter":{"isOriginal":true,"title":"虚拟机环境配置","date":"2021-12-07T00:00:00.000Z","icon":"code","tag":["vbox","docker"],"category":"docker","description":"虚拟机环境配置，包括docker环境和vbox环境，以及一些常用的服务部署.","sticky":false,"timeline":true,"article":true,"star":true,"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"虚拟机环境配置\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2021-12-07T00:00:00.000Z\\",\\"dateModified\\":\\"2025-12-07T16:26:37.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"DewyYr、\\",\\"url\\":\\"https://blog.nikolazh.eu.org\\"}]}"],["meta",{"property":"og:url","content":"https://blog.nikolazh.eu.org/posts/vm/01-%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE.html"}],["meta",{"property":"og:title","content":"虚拟机环境配置"}],["meta",{"property":"og:description","content":"虚拟机环境配置，包括docker环境和vbox环境，以及一些常用的服务部署."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-12-07T16:26:37.000Z"}],["meta",{"property":"article:tag","content":"docker"}],["meta",{"property":"article:tag","content":"vbox"}],["meta",{"property":"article:published_time","content":"2021-12-07T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-12-07T16:26:37.000Z"}]]},"git":{"createdTime":1665625617000,"updatedTime":1765124797000,"contributors":[{"name":"zhangxu","username":"zhangxu","email":"nikolazhang@163.com","commits":8,"url":"https://github.com/zhangxu"},{"name":"nikola","username":"nikola","email":"nikolazhang@163.com","commits":1,"url":"https://github.com/nikola"},{"name":"我小叮当","username":"","email":"nikolazhang@163.com","commits":4}]},"readingTime":{"minutes":4.61,"words":1384},"filePathRelative":"posts/vm/01-虚拟机环境配置.md"}');export{p as comp,d as data};
