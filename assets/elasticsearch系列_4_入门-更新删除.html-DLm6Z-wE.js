import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,e,o as n}from"./app-Cio7tDO8.js";const t={};function l(h,i){return n(),a("div",null,[...i[0]||(i[0]=[e(`<h2 id="更新文档" tabindex="-1"><a class="header-anchor" href="#更新文档"><span>更新文档</span></a></h2><p>文档在elasticsearch中是不可变的. 但是可以通过重建索引进行替换.</p><figure><img src="http://dewy-blog.nikolazh.eu.org/2020-02-01-20-17-00.png" alt="2020-02-01-20-17-00" tabindex="0" loading="lazy"><figcaption>2020-02-01-20-17-00</figcaption></figure><p>如果我们要修改上面截图中的<code>age</code>字段, 可以将之前的PUT方法中的<code>age</code>值修改并重新运行, 即可. <img src="http://dewy-blog.nikolazh.eu.org/2020-02-01-20-18-20.png" alt="2020-02-01-20-18-20" loading="lazy"></p><p>注意此时的_version字段会增加1, 这个设计如同数据库中我们使用乐观锁. 都是通过版本号实现.</p><h3 id="局部更新" tabindex="-1"><a class="header-anchor" href="#局部更新"><span>局部更新</span></a></h3><p>上面通过全文更新过于繁琐. 现在就介绍一种更加简单的方式进行更新.</p><figure><img src="http://dewy-blog.nikolazh.eu.org/2020-02-03-15-46-28.png" alt="2020-02-03-15-46-28" tabindex="0" loading="lazy"><figcaption>2020-02-03-15-46-28</figcaption></figure><p>比如更改上面文档中的age:</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-json"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">POST /megacorp/employee/</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/_update</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;doc&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      &quot;age&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> :  </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">40</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行之后, 重新查询: <img src="http://dewy-blog.nikolazh.eu.org/2020-02-03-15-48-23.png" alt="2020-02-03-15-48-23" loading="lazy"> 结果已经变成我们设置的值了.</p><h4 id="通过脚本更新" tabindex="-1"><a class="header-anchor" href="#通过脚本更新"><span>通过脚本更新</span></a></h4><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-json"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">POST /megacorp/employee/</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/_update</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;script&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> : </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ctx._source.age+=1&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>ctx._source</code>表示的是<code>_source</code></p><p>注意如果不确定更新的字段是否存在, 可以使用<code>upsert</code>指定初始值创建.</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-json"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">POST /megacorp/employee/</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/_update</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">   &quot;script&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> : </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ctx._source.views+=1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">   &quot;upsert&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">       &quot;views&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="更新和冲突" tabindex="-1"><a class="header-anchor" href="#更新和冲突"><span>更新和冲突</span></a></h4><p>如果版本号发生冲突, 并且在更新先后不重要的情况下. 可以尝试再次更新. 这可以通过设置参数 <code>retry_on_conflict</code> 来自动完成, 这个参数规定了失败之前 update 应该重试的次数, 它的默认值为0 。</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-json"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">POST /megacorp/employee/</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/_update?retry_on_conflict=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">   &quot;script&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> : </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ctx._source.views+=1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">   &quot;upsert&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">       &quot;views&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="删除" tabindex="-1"><a class="header-anchor" href="#删除"><span>删除</span></a></h2><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-json"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">DELETE /school-demo/school/</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="http://dewy-blog.nikolazh.eu.org/2020-02-01-20-51-52.png" alt="2020-02-01-20-51-52" tabindex="0" loading="lazy"><figcaption>2020-02-01-20-51-52</figcaption></figure>`,22)])])}const d=s(t,[["render",l]]),o=JSON.parse('{"path":"/posts/elasticsearch/elasticsearch%E7%B3%BB%E5%88%97_4_%E5%85%A5%E9%97%A8-%E6%9B%B4%E6%96%B0%E5%88%A0%E9%99%A4.html","title":"ElasticSearch[4]操作篇-更新和删除","lang":"en-US","frontmatter":{"isOriginal":true,"title":"ElasticSearch[4]操作篇-更新和删除","tag":["es更新","es删除"],"category":"ElasticSearch","description":"简单介绍一下elasticsearch文档的更新和删除","date":"2020-02-03T00:00:00.000Z","sticky":false,"timeline":true,"article":true,"star":false,"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"ElasticSearch[4]操作篇-更新和删除\\",\\"image\\":[\\"http://dewy-blog.nikolazh.eu.org/2020-02-01-20-17-00.png\\",\\"http://dewy-blog.nikolazh.eu.org/2020-02-01-20-18-20.png\\",\\"http://dewy-blog.nikolazh.eu.org/2020-02-03-15-46-28.png\\",\\"http://dewy-blog.nikolazh.eu.org/2020-02-03-15-48-23.png\\",\\"http://dewy-blog.nikolazh.eu.org/2020-02-01-20-51-52.png\\"],\\"datePublished\\":\\"2020-02-03T00:00:00.000Z\\",\\"dateModified\\":\\"2025-12-03T07:59:07.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"我小叮当、\\",\\"url\\":\\"https://nikolazhang.github.io\\"}]}"],["meta",{"property":"og:url","content":"https://nikolazhang.github.io/posts/elasticsearch/elasticsearch%E7%B3%BB%E5%88%97_4_%E5%85%A5%E9%97%A8-%E6%9B%B4%E6%96%B0%E5%88%A0%E9%99%A4.html"}],["meta",{"property":"og:title","content":"ElasticSearch[4]操作篇-更新和删除"}],["meta",{"property":"og:description","content":"简单介绍一下elasticsearch文档的更新和删除"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"http://dewy-blog.nikolazh.eu.org/2020-02-01-20-17-00.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-12-03T07:59:07.000Z"}],["meta",{"property":"article:tag","content":"es删除"}],["meta",{"property":"article:tag","content":"es更新"}],["meta",{"property":"article:published_time","content":"2020-02-03T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-12-03T07:59:07.000Z"}]]},"git":{"createdTime":1665625617000,"updatedTime":1764748747000,"contributors":[{"name":"zhangxu","username":"zhangxu","email":"nikolazhang@163.com","commits":5,"url":"https://github.com/zhangxu"},{"name":"nikola","username":"nikola","email":"nikolazhang@163.com","commits":2,"url":"https://github.com/nikola"},{"name":"我小叮当","username":"","email":"nikolazhang@163.com","commits":2}]},"readingTime":{"minutes":1.52,"words":456},"filePathRelative":"posts/elasticsearch/elasticsearch系列[4]入门-更新删除.md"}');export{d as comp,o as data};
