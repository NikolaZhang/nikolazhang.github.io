import{_ as l}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as p,a,e as n,b as e,r as t,o as r}from"./app-C-3iPMF1.js";const d={};function h(o,s){const i=t("Mermaid");return r(),p("div",null,[s[0]||(s[0]=a('<h2 id="_1-简介" tabindex="-1"><a class="header-anchor" href="#_1-简介"><span>1. 简介</span></a></h2><p>在实际应用中，单机Redis存在诸多限制，如单点故障、性能瓶颈、内存容量限制等。为了解决这些问题，Redis提供了主从复制（Master-Slave Replication）和哨兵模式（Sentinel）两种高可用性解决方案。</p><p>主从复制通过将数据从主节点复制到多个从节点，实现数据的备份和读写分离；哨兵模式则在主从复制的基础上，提供了自动故障转移功能，确保Redis集群的高可用性。</p><p>本文将详细介绍Redis主从复制和哨兵模式的原理、配置、工作流程以及实际应用。</p><h2 id="_2-主从复制" tabindex="-1"><a class="header-anchor" href="#_2-主从复制"><span>2. 主从复制</span></a></h2><h3 id="_2-1-主从复制基本概念" tabindex="-1"><a class="header-anchor" href="#_2-1-主从复制基本概念"><span>2.1 主从复制基本概念</span></a></h3><p>主从复制是指将一个Redis服务器（主节点）的数据复制到多个Redis服务器（从节点）的过程。主节点负责处理写命令和读命令，从节点主要负责处理读命令，从而实现读写分离。</p>',7)),n(i,{code:"eJxLL0osyFAIceFSAALH6KfrFj3r2P589fpYBV1dOwWn6Cc7dr/oanretFPBN7G4JLUoFqIQLOsc/WR3H1Q2OCexLFXBEFnaBUPaCFnaFUPaGCLtBDEciQ1xHYTtygUAQMo9Yw=="}),s[1]||(s[1]=a('<h3 id="_2-2-主从复制的作用" tabindex="-1"><a class="header-anchor" href="#_2-2-主从复制的作用"><span>2.2 主从复制的作用</span></a></h3><ol><li><strong>数据备份</strong>：将主节点的数据复制到从节点，实现数据的备份和冗余。</li><li><strong>读写分离</strong>：主节点负责写操作，从节点负责读操作，提高系统的并发处理能力。</li><li><strong>负载均衡</strong>：将读请求分散到多个从节点，减轻主节点的负载。</li><li><strong>故障恢复</strong>：当主节点发生故障时，可以手动将从节点提升为主节点，恢复服务。</li></ol><h3 id="_2-3-主从复制的工作原理" tabindex="-1"><a class="header-anchor" href="#_2-3-主从复制的工作原理"><span>2.3 主从复制的工作原理</span></a></h3><p>主从复制的工作流程主要包括以下几个阶段：</p><ol><li><strong>建立连接</strong>：从节点通过<code>SLAVEOF</code>命令与主节点建立连接。</li><li><strong>同步数据</strong>：从节点与主节点进行数据同步，获取主节点的完整数据副本。</li><li><strong>命令传播</strong>：主节点将写命令传播给从节点，保持数据的一致性。</li></ol>',5)),n(i,{code:"eJwrTi0sTc1LTnXJTEwvSszlUgCCgsSikszkzILEvBIF38TiktQihcRihSc7dr/oanretBNDTXBOYlkqWMnuPqgSsBqwuK6dHcQMK4Wn/RNfNjQGR/o5P52498nuJWBFEEkkVc86l79Y2OPkHuwY5vp8yvxnHROCXJyeTWt/snsbqgaw8TBTUdXAbIYqebaj9fnKXU/3Tn7a2fts6oZnveuwqXrateDF3r3EWAZx3LM5819O3/J8VsvTtplIHkK3G+ydZ1O2Pe3YgKHWL78kVSG/DBjAEIt0oJpe7J/9tHUpROGTPQueTVr7csa2Z+u2YnfTunnPpm+DuAyvUyAKIQ5CKAQAd9bsqA=="}),s[2]||(s[2]=a(`<h3 id="_2-4-主从复制的同步方式" tabindex="-1"><a class="header-anchor" href="#_2-4-主从复制的同步方式"><span>2.4 主从复制的同步方式</span></a></h3><p>Redis主从复制支持两种同步方式：</p><ol><li><strong>全量同步</strong>：从节点第一次连接主节点时，获取主节点的完整数据副本。</li><li><strong>增量同步</strong>：从节点与主节点断开连接后重新连接时，只获取断开期间主节点的写命令。</li></ol><h4 id="_2-4-1-全量同步" tabindex="-1"><a class="header-anchor" href="#_2-4-1-全量同步"><span>2.4.1 全量同步</span></a></h4><p>全量同步的工作流程：</p><ol><li>从节点向主节点发送<code>SYNC</code>命令。</li><li>主节点执行<code>BGSAVE</code>命令生成RDB文件。</li><li>主节点将生成的RDB文件发送给从节点。</li><li>从节点接收RDB文件并加载到内存中。</li><li>主节点将<code>BGSAVE</code>期间的写命令发送给从节点。</li><li>从节点执行这些写命令，使数据与主节点保持一致。</li></ol><h4 id="_2-4-2-增量同步" tabindex="-1"><a class="header-anchor" href="#_2-4-2-增量同步"><span>2.4.2 增量同步</span></a></h4><p>增量同步的工作流程：</p><ol><li>主节点维护一个复制偏移量（Replication Offset），记录发送给从节点的字节数。</li><li>从节点也维护一个复制偏移量，记录接收主节点的字节数。</li><li>从节点还维护一个复制积压缓冲区（Replication Backlog Buffer），用于存储主节点最近的写命令。</li><li>当从节点断开连接后重新连接时，会向主节点发送自己的复制偏移量。</li><li>主节点检查复制积压缓冲区，如果包含从节点缺失的写命令，则只发送这些命令（增量同步）。</li><li>如果不包含，则进行全量同步。</li></ol><h3 id="_2-5-主从复制配置" tabindex="-1"><a class="header-anchor" href="#_2-5-主从复制配置"><span>2.5 主从复制配置</span></a></h3><h4 id="_2-5-1-主节点配置" tabindex="-1"><a class="header-anchor" href="#_2-5-1-主节点配置"><span>2.5.1 主节点配置</span></a></h4><p>主节点一般不需要特殊配置，默认情况下即可接受从节点的连接请求。可以通过以下参数进行优化：</p><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span># 开启AOF持久化</span></span>
<span class="line"><span>appendonly yes</span></span>
<span class="line"><span># 每秒钟同步一次</span></span>
<span class="line"><span>appendfsync everysec</span></span>
<span class="line"><span># 启用复制积压缓冲区</span></span>
<span class="line"><span>repl-backlog-size 1mb</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-5-2-从节点配置" tabindex="-1"><a class="header-anchor" href="#_2-5-2-从节点配置"><span>2.5.2 从节点配置</span></a></h4><p>从节点需要配置主节点的地址和端口：</p><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span># 配置主节点地址和端口</span></span>
<span class="line"><span>slaveof 127.0.0.1 6379</span></span>
<span class="line"><span># 从节点只读</span></span>
<span class="line"><span>slave-read-only yes</span></span>
<span class="line"><span># 启用复制积压缓冲区</span></span>
<span class="line"><span>repl-backlog-size 1mb</span></span>
<span class="line"><span># 从节点优先级，用于故障转移</span></span>
<span class="line"><span>slave-priority 100</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>也可以在运行时通过命令配置：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 在从节点上执行</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SLAVEOF</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 127.0.0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6379</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-6-主从复制的拓扑结构" tabindex="-1"><a class="header-anchor" href="#_2-6-主从复制的拓扑结构"><span>2.6 主从复制的拓扑结构</span></a></h3><p>Redis主从复制支持多种拓扑结构：</p><h4 id="_2-6-1-一主多从" tabindex="-1"><a class="header-anchor" href="#_2-6-1-一主多从"><span>2.6.1 一主多从</span></a></h4><p>一个主节点对应多个从节点，是最常见的拓扑结构。</p>`,22)),n(i,{code:"eJxLL0osyFAIceFSAALHaN/E4pLUolgFXV07Bafo4JzEslTDWIgcWMwZImaELOYCETOO5QIAMlgUWg=="}),s[3]||(s[3]=e("h4",{id:"_2-6-2-树状结构",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#_2-6-2-树状结构"},[e("span",null,"2.6.2 树状结构")])],-1)),s[4]||(s[4]=e("p",null,"从节点可以作为其他从节点的主节点，形成树状结构。",-1)),n(i,{code:"eJxLL0osyFAIceFSAALHaN/E4pLUolgFXV07Bafo4JzEslTDWIgcWMwZImYEEXMCi7lA1elCVUJEXWGiULXOYFE3qH6QWgDHvx8R"}),s[5]||(s[5]=a('<h3 id="_2-7-主从复制的注意事项" tabindex="-1"><a class="header-anchor" href="#_2-7-主从复制的注意事项"><span>2.7 主从复制的注意事项</span></a></h3><ol><li><strong>数据一致性</strong>：主从复制存在一定的延迟，可能导致数据不一致。</li><li><strong>主节点故障</strong>：主节点故障后，需要手动将从节点提升为主节点。</li><li><strong>网络带宽</strong>：大量从节点可能会占用主节点的网络带宽。</li><li><strong>从节点只读</strong>：从节点默认是只读的，不能执行写命令。</li></ol><h2 id="_3-哨兵模式" tabindex="-1"><a class="header-anchor" href="#_3-哨兵模式"><span>3. 哨兵模式</span></a></h2><h3 id="_3-1-哨兵模式基本概念" tabindex="-1"><a class="header-anchor" href="#_3-1-哨兵模式基本概念"><span>3.1 哨兵模式基本概念</span></a></h3><p>哨兵模式是Redis提供的高可用性解决方案，它在主从复制的基础上，增加了对主节点的监控、自动故障转移和配置管理功能。</p><p>哨兵模式由多个哨兵节点组成，这些节点协同工作，监控主从节点的状态，当主节点发生故障时，自动将从节点提升为主节点，确保服务的可用性。</p>',6)),n(i,{code:"eJxLL0osyFAIceFSAALH6KfrFj3r2P589fpYBV1dOwWn6ODUvJLMvNQcw1iICrCwM1zYCFnYBS5sDBF2Agu7RvsmFpekFkHEnCFiYLYLEtsVzHaLDs5JLEuF2gYRc4eIQa2CiHlAxFDscUMyH8KGmA9hQ9S4I6mBsCFqIGyIGg8kNRA2RI0HFwDrOEUF"}),s[6]||(s[6]=a('<h3 id="_3-2-哨兵模式的作用" tabindex="-1"><a class="header-anchor" href="#_3-2-哨兵模式的作用"><span>3.2 哨兵模式的作用</span></a></h3><ol><li><strong>监控</strong>：监控主从节点的状态，确保它们正常运行。</li><li><strong>自动故障转移</strong>：当主节点发生故障时，自动将从节点提升为主节点。</li><li><strong>配置管理</strong>：管理客户端的配置，当主节点发生变化时，更新客户端的配置。</li><li><strong>通知</strong>：当节点状态发生变化时，通知客户端和管理员。</li></ol><h3 id="_3-3-哨兵模式的工作原理" tabindex="-1"><a class="header-anchor" href="#_3-3-哨兵模式的工作原理"><span>3.3 哨兵模式的工作原理</span></a></h3><p>哨兵模式的工作流程主要包括以下几个阶段：</p><ol><li><strong>监控阶段</strong>：哨兵节点定期监控主从节点的状态。</li><li><strong>判断阶段</strong>：判断主节点是否发生故障。</li><li><strong>协商阶段</strong>：哨兵节点之间进行协商，选举出领头哨兵。</li><li><strong>故障转移阶段</strong>：领头哨兵执行故障转移，将从节点提升为主节点。</li><li><strong>通知阶段</strong>：通知其他节点和客户端新的主节点信息。</li></ol>',5)),n(i,{code:"eJxLL0osyFAIceFSAALH6OezJz7rW/5kx+4nu/tedDU9b9oZq6Cra6fgVA0Ugwg8m7H+6YRlz6a2vpw1x74WrM8JpKYGKFGj4Bz9sqHzyY59Lxe1PV2y5enkFU9bt8aCFTmDDXIByT/rXvl0QsfLhqbns1oQFoFVuYBVuUY/65/wtLf9yY5dz6ZtgFsNUeIKVuIW/bR125Pd0+D6ny7pfdqxDVO5G1i5O9DeWc/nL326btGzju3PV69HVvhk/8JnjeshyiF+AfqwRsGRCwBp7ZK5"}),s[7]||(s[7]=a(`<h3 id="_3-4-哨兵模式的核心功能" tabindex="-1"><a class="header-anchor" href="#_3-4-哨兵模式的核心功能"><span>3.4 哨兵模式的核心功能</span></a></h3><h4 id="_3-4-1-节点监控" tabindex="-1"><a class="header-anchor" href="#_3-4-1-节点监控"><span>3.4.1 节点监控</span></a></h4><p>哨兵节点通过定期发送<code>PING</code>命令监控主从节点的状态：</p><ol><li><strong>主观下线</strong>：当哨兵节点在一定时间内没有收到主节点的响应时，认为主节点主观下线。</li><li><strong>客观下线</strong>：当多个哨兵节点都认为主节点主观下线时，通过投票机制判断主节点客观下线。</li></ol><h4 id="_3-4-2-故障转移" tabindex="-1"><a class="header-anchor" href="#_3-4-2-故障转移"><span>3.4.2 故障转移</span></a></h4><p>当主节点被判断为客观下线时，哨兵节点会执行故障转移：</p><ol><li><strong>选举领头哨兵</strong>：通过Raft算法选举出一个领头哨兵。</li><li><strong>选择新主节点</strong>：选择一个合适的从节点作为新的主节点。</li><li><strong>提升新主节点</strong>：将选择的从节点提升为主节点。</li><li><strong>更新配置</strong>：更新其他从节点的配置，使其复制新主节点。</li><li><strong>通知客户端</strong>：通知客户端新主节点的信息。</li></ol><h4 id="_3-4-3-配置管理" tabindex="-1"><a class="header-anchor" href="#_3-4-3-配置管理"><span>3.4.3 配置管理</span></a></h4><p>哨兵节点维护着Redis集群的配置信息，当主节点发生变化时，会更新配置信息并通知客户端。</p><h3 id="_3-5-哨兵模式的配置" tabindex="-1"><a class="header-anchor" href="#_3-5-哨兵模式的配置"><span>3.5 哨兵模式的配置</span></a></h3><h4 id="_3-5-1-哨兵节点配置" tabindex="-1"><a class="header-anchor" href="#_3-5-1-哨兵节点配置"><span>3.5.1 哨兵节点配置</span></a></h4><p>哨兵节点的配置文件（sentinel.conf）：</p><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span># 哨兵节点端口</span></span>
<span class="line"><span>port 26379</span></span>
<span class="line"><span># 守护进程模式</span></span>
<span class="line"><span>daemonize yes</span></span>
<span class="line"><span># 日志文件</span></span>
<span class="line"><span>logfile &quot;/var/log/redis/sentinel.log&quot;</span></span>
<span class="line"><span># 数据目录</span></span>
<span class="line"><span>dir &quot;/var/lib/redis/sentinel&quot;</span></span>
<span class="line"><span># 监控主节点，mymaster是主节点名称，127.0.0.1是主节点IP，6379是主节点端口，2是故障判断的最小哨兵数量</span></span>
<span class="line"><span>sentinel monitor mymaster 127.0.0.1 6379 2</span></span>
<span class="line"><span># 连接主节点的密码</span></span>
<span class="line"><span>sentinel auth-pass mymaster yourpassword</span></span>
<span class="line"><span># 主节点主观下线时间（毫秒）</span></span>
<span class="line"><span>sentinel down-after-milliseconds mymaster 30000</span></span>
<span class="line"><span># 故障转移超时时间（毫秒）</span></span>
<span class="line"><span>sentinel failover-timeout mymaster 180000</span></span>
<span class="line"><span># 故障转移时，同时同步的从节点数量</span></span>
<span class="line"><span>sentinel parallel-syncs mymaster 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-5-2-启动哨兵节点" tabindex="-1"><a class="header-anchor" href="#_3-5-2-启动哨兵节点"><span>3.5.2 启动哨兵节点</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /path/to/sentinel.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>或</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /path/to/sentinel.conf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --sentinel</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3-6-哨兵模式的故障转移流程" tabindex="-1"><a class="header-anchor" href="#_3-6-哨兵模式的故障转移流程"><span>3.6 哨兵模式的故障转移流程</span></a></h3><p>哨兵模式的故障转移流程主要包括以下几个步骤：</p>`,19)),n(i,{code:"eJyllF9r01AUwN/3Ke4HMJI/+K8PA9Epgm2FgO9xDRLo2plWxbe2uK0626zMVZmC24hUUFMFt9bWuS+Te5N8i93cLElzb9IN1r6Ec38553dOTlJTnz1XK8vqXU15qisrCwD/VhW9ri1rq0qlDmQBKDUAt7/BtUP3bctp/RVYRqQZkWUkmpEYJu8j9nganLMpygqRsafdTJOyQlwihBW5U9aIiXWA2iPn+3CBEIVqXQXVF6qOG74iSzngfOqh7sD7eISsQ0LIAre4mM+BRw8K94OASAckKpDncEAWcKSYiIhMBBckEcoFJ4vGgXbWvN3Pl1ZBH/bgdgdO3id90sJYKg6nTwm2TdT/SU+J1NnbcK1fkb1/MWjZ401nchIrk8rngX4rxOU8kJTGGaHR8xpNrcatKLW6qnOl6ssK9+QVp5RKOuwd21NzhvebuCBPjHFrzr7lWuaMCOU6H8kYEN7HuJ2MYXcMuLPODDvq2Gu8scf/3eEI/W6ldciehx3BrXfotRGcJxthTyL/9pY9nngH69D8E7zWrDamyNa6xz+cwZQxx+9zDrjdETT60OzA9hFsGj63YSQg3OAcCCcJd5s6zwGB5/mQEjOpW9fOoFgqGJj88PbjpeI9UCiCYmFpdhX8oiEbDAL142dJ2yezCeKNqzz+C+C6dJNPZiUPJLjnXwMONgPXRO6UIXuNXefL1+zFmL3fPtlHzWHaesyj8EczLJOF+eoXwPzFmo+dAl5J1RE="}),s[8]||(s[8]=a(`<h3 id="_3-7-哨兵模式的注意事项" tabindex="-1"><a class="header-anchor" href="#_3-7-哨兵模式的注意事项"><span>3.7 哨兵模式的注意事项</span></a></h3><ol><li><strong>哨兵数量</strong>：哨兵节点的数量应该是奇数（至少3个），避免投票时出现平局。</li><li><strong>网络稳定性</strong>：哨兵节点之间和哨兵节点与主从节点之间的网络连接要稳定。</li><li><strong>配置一致性</strong>：所有哨兵节点的配置要保持一致。</li><li><strong>性能影响</strong>：哨兵节点会定期发送命令监控主从节点，对性能有一定影响。</li></ol><h2 id="_4-主从复制与哨兵模式的对比" tabindex="-1"><a class="header-anchor" href="#_4-主从复制与哨兵模式的对比"><span>4. 主从复制与哨兵模式的对比</span></a></h2><h3 id="_4-1-功能对比" tabindex="-1"><a class="header-anchor" href="#_4-1-功能对比"><span>4.1 功能对比</span></a></h3><table><thead><tr><th>特性</th><th>主从复制</th><th>哨兵模式</th></tr></thead><tbody><tr><td>数据备份</td><td>支持</td><td>支持</td></tr><tr><td>读写分离</td><td>支持</td><td>支持</td></tr><tr><td>自动故障转移</td><td>不支持</td><td>支持</td></tr><tr><td>节点监控</td><td>不支持</td><td>支持</td></tr><tr><td>配置管理</td><td>不支持</td><td>支持</td></tr><tr><td>客户端通知</td><td>不支持</td><td>支持</td></tr></tbody></table><h3 id="_4-2-优缺点对比" tabindex="-1"><a class="header-anchor" href="#_4-2-优缺点对比"><span>4.2 优缺点对比</span></a></h3><h4 id="_4-2-1-主从复制" tabindex="-1"><a class="header-anchor" href="#_4-2-1-主从复制"><span>4.2.1 主从复制</span></a></h4><p><strong>优点</strong>：</p><ol><li>配置简单，易于维护</li><li>对性能影响小</li><li>支持读写分离，提高并发处理能力</li></ol><p><strong>缺点</strong>：</p><ol><li>不支持自动故障转移</li><li>主节点故障后需要手动恢复</li><li>没有节点监控和配置管理功能</li></ol><h4 id="_4-2-2-哨兵模式" tabindex="-1"><a class="header-anchor" href="#_4-2-2-哨兵模式"><span>4.2.2 哨兵模式</span></a></h4><p><strong>优点</strong>：</p><ol><li>支持自动故障转移</li><li>提供节点监控功能</li><li>提供配置管理和客户端通知功能</li><li>提高系统的可用性</li></ol><p><strong>缺点</strong>：</p><ol><li>配置复杂，维护成本高</li><li>对性能有一定影响</li><li>故障转移过程中可能会出现短暂的服务中断</li></ol><h3 id="_4-3-适用场景" tabindex="-1"><a class="header-anchor" href="#_4-3-适用场景"><span>4.3 适用场景</span></a></h3><h4 id="_4-3-1-主从复制" tabindex="-1"><a class="header-anchor" href="#_4-3-1-主从复制"><span>4.3.1 主从复制</span></a></h4><ol><li><strong>数据备份</strong>：需要将数据备份到多个节点的场景。</li><li><strong>读写分离</strong>：读请求量远大于写请求量的场景。</li><li><strong>负载均衡</strong>：需要将读请求分散到多个节点的场景。</li><li><strong>资源有限</strong>：对系统可用性要求不高，资源有限的场景。</li></ol><h4 id="_4-3-2-哨兵模式" tabindex="-1"><a class="header-anchor" href="#_4-3-2-哨兵模式"><span>4.3.2 哨兵模式</span></a></h4><ol><li><strong>高可用性要求</strong>：对系统可用性要求高，需要自动故障转移的场景。</li><li><strong>关键业务</strong>：关键业务系统，需要确保服务不中断的场景。</li><li><strong>无人值守</strong>：需要无人值守，自动恢复的场景。</li></ol><h2 id="_5-实际应用与注意事项" tabindex="-1"><a class="header-anchor" href="#_5-实际应用与注意事项"><span>5. 实际应用与注意事项</span></a></h2><h3 id="_5-1-主从复制配置示例" tabindex="-1"><a class="header-anchor" href="#_5-1-主从复制配置示例"><span>5.1 主从复制配置示例</span></a></h3><h4 id="_5-1-1-主节点配置-redis-conf" tabindex="-1"><a class="header-anchor" href="#_5-1-1-主节点配置-redis-conf"><span>5.1.1 主节点配置（redis.conf）</span></a></h4><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span># 端口</span></span>
<span class="line"><span>port 6379</span></span>
<span class="line"><span># 守护进程模式</span></span>
<span class="line"><span>daemonize yes</span></span>
<span class="line"><span># 绑定地址</span></span>
<span class="line"><span>bind 0.0.0.0</span></span>
<span class="line"><span># 密码</span></span>
<span class="line"><span>requirepass yourpassword</span></span>
<span class="line"><span># 日志文件</span></span>
<span class="line"><span>logfile &quot;/var/log/redis/redis.log&quot;</span></span>
<span class="line"><span># 数据目录</span></span>
<span class="line"><span>dir &quot;/var/lib/redis&quot;</span></span>
<span class="line"><span># 开启AOF持久化</span></span>
<span class="line"><span>appendonly yes</span></span>
<span class="line"><span># 每秒钟同步一次</span></span>
<span class="line"><span>appendfsync everysec</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-1-2-从节点配置-redis-slave-conf" tabindex="-1"><a class="header-anchor" href="#_5-1-2-从节点配置-redis-slave-conf"><span>5.1.2 从节点配置（redis-slave.conf）</span></a></h4><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span># 端口</span></span>
<span class="line"><span>port 6380</span></span>
<span class="line"><span># 守护进程模式</span></span>
<span class="line"><span>daemonize yes</span></span>
<span class="line"><span># 绑定地址</span></span>
<span class="line"><span>bind 0.0.0.0</span></span>
<span class="line"><span># 密码</span></span>
<span class="line"><span>requirepass yourpassword</span></span>
<span class="line"><span># 主节点密码</span></span>
<span class="line"><span>masterauth yourpassword</span></span>
<span class="line"><span># 配置主节点</span></span>
<span class="line"><span>slaveof 127.0.0.1 6379</span></span>
<span class="line"><span># 从节点只读</span></span>
<span class="line"><span>slave-read-only yes</span></span>
<span class="line"><span># 日志文件</span></span>
<span class="line"><span>logfile &quot;/var/log/redis/redis-slave.log&quot;</span></span>
<span class="line"><span># 数据目录</span></span>
<span class="line"><span>dir &quot;/var/lib/redis-slave&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-哨兵模式配置示例" tabindex="-1"><a class="header-anchor" href="#_5-2-哨兵模式配置示例"><span>5.2 哨兵模式配置示例</span></a></h3><h4 id="_5-2-1-哨兵节点配置-sentinel-conf" tabindex="-1"><a class="header-anchor" href="#_5-2-1-哨兵节点配置-sentinel-conf"><span>5.2.1 哨兵节点配置（sentinel.conf）</span></a></h4><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span># 端口</span></span>
<span class="line"><span>port 26379</span></span>
<span class="line"><span># 守护进程模式</span></span>
<span class="line"><span>daemonize yes</span></span>
<span class="line"><span># 绑定地址</span></span>
<span class="line"><span>bind 0.0.0.0</span></span>
<span class="line"><span># 日志文件</span></span>
<span class="line"><span>logfile &quot;/var/log/redis/sentinel.log&quot;</span></span>
<span class="line"><span># 数据目录</span></span>
<span class="line"><span>dir &quot;/var/lib/redis/sentinel&quot;</span></span>
<span class="line"><span># 监控主节点</span></span>
<span class="line"><span>sentinel monitor mymaster 127.0.0.1 6379 2</span></span>
<span class="line"><span># 主节点密码</span></span>
<span class="line"><span>sentinel auth-pass mymaster yourpassword</span></span>
<span class="line"><span># 主观下线时间</span></span>
<span class="line"><span>sentinel down-after-milliseconds mymaster 30000</span></span>
<span class="line"><span># 故障转移超时时间</span></span>
<span class="line"><span>sentinel failover-timeout mymaster 180000</span></span>
<span class="line"><span># 并行同步数量</span></span>
<span class="line"><span>sentinel parallel-syncs mymaster 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-客户端连接哨兵模式" tabindex="-1"><a class="header-anchor" href="#_5-3-客户端连接哨兵模式"><span>5.3 客户端连接哨兵模式</span></a></h3><p>使用Jedis客户端连接哨兵模式：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> redis.clients.jedis.JedisPoolConfig</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> redis.clients.jedis.JedisSentinelPool</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> java.util.HashSet</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> java.util.Set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> SentinelExample</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 哨兵节点集合</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        Set</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sentinels</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> HashSet</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        sentinels</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;127.0.0.1:26379&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        sentinels</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;127.0.0.1:26380&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        sentinels</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;127.0.0.1:26381&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 主节点名称</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> masterName</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;mymaster&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 密码</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> password</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;yourpassword&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 连接池配置</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        JedisPoolConfig</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> poolConfig</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> JedisPoolConfig</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        poolConfig</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setMaxTotal</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        poolConfig</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setMaxIdle</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        poolConfig</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setMinIdle</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 创建哨兵连接池</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        JedisSentinelPool</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> sentinelPool</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> JedisSentinelPool</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(masterName, sentinels, poolConfig, password);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 获取连接</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        try</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Jedis</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> jedis</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> sentinelPool</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getResource</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            // 执行命令</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            jedis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;key&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;value&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">            String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> result</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> jedis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;key&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(result);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 关闭连接池</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        sentinelPool</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-注意事项" tabindex="-1"><a class="header-anchor" href="#_5-4-注意事项"><span>5.4 注意事项</span></a></h3><ol><li><strong>网络配置</strong>：确保主从节点和哨兵节点之间的网络连接稳定。</li><li><strong>密码配置</strong>：主从节点和哨兵节点的密码要保持一致。</li><li><strong>持久化配置</strong>：主节点要开启持久化，确保数据不丢失。</li><li><strong>资源配置</strong>：根据业务需求配置节点的内存、CPU等资源。</li><li><strong>监控配置</strong>：配置监控系统，实时监控节点的状态。</li><li><strong>备份策略</strong>：制定定期备份策略，确保数据安全。</li><li><strong>测试故障转移</strong>：定期测试故障转移功能，确保其正常工作。</li></ol><h2 id="_6-redis-7-0-主从复制与哨兵模式改进" tabindex="-1"><a class="header-anchor" href="#_6-redis-7-0-主从复制与哨兵模式改进"><span>6. Redis 7.0+主从复制与哨兵模式改进</span></a></h2><h3 id="_6-1-主从复制改进" tabindex="-1"><a class="header-anchor" href="#_6-1-主从复制改进"><span>6.1 主从复制改进</span></a></h3><p>Redis 7.0对主从复制进行了多项改进：</p><ol><li><strong>复制优化</strong>：优化了复制的性能和稳定性。</li><li><strong>增量同步改进</strong>：改进了增量同步的机制，减少数据传输量。</li><li><strong>多主复制</strong>：支持多主复制，提高系统的可用性。</li></ol><h3 id="_6-2-哨兵模式改进" tabindex="-1"><a class="header-anchor" href="#_6-2-哨兵模式改进"><span>6.2 哨兵模式改进</span></a></h3><p>Redis 7.0对哨兵模式进行了以下改进：</p><ol><li><strong>哨兵监控优化</strong>：优化了哨兵节点的监控机制，提高监控的准确性。</li><li><strong>故障转移优化</strong>：优化了故障转移的流程，减少故障转移的时间。</li><li><strong>配置管理改进</strong>：改进了配置管理功能，提高配置的一致性。</li></ol><h2 id="_7-总结" tabindex="-1"><a class="header-anchor" href="#_7-总结"><span>7. 总结</span></a></h2><p>Redis主从复制和哨兵模式是Redis提供的两种高可用性解决方案。主从复制通过将数据从主节点复制到多个从节点，实现数据的备份和读写分离；哨兵模式则在主从复制的基础上，增加了对主节点的监控、自动故障转移和配置管理功能。</p><p>在实际应用中，应该根据业务需求和系统可用性要求选择合适的解决方案。对于数据备份和读写分离的需求，可以选择主从复制；对于高可用性要求高的关键业务系统，可以选择哨兵模式。</p><p>无论选择哪种解决方案，都需要合理配置和维护，确保系统的稳定性和可用性。同时，还需要定期测试和监控，及时发现和解决问题，确保系统的正常运行。</p><h2 id="_8-参考资料" tabindex="-1"><a class="header-anchor" href="#_8-参考资料"><span>8. 参考资料</span></a></h2><ol><li>Redis官方文档：<a href="https://redis.io/documentation" target="_blank" rel="noopener noreferrer">https://redis.io/documentation</a></li><li>Redis命令参考：<a href="https://redis.io/commands" target="_blank" rel="noopener noreferrer">https://redis.io/commands</a></li><li>《Redis设计与实现》</li><li>《Redis实战》</li></ol>`,48))])}const g=l(d,[["render",h]]),v=JSON.parse('{"path":"/posts/redis/04-Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E4%B8%8E%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F.html","title":"Redis主从复制与哨兵模式详解","lang":"en-US","frontmatter":{"title":"Redis主从复制与哨兵模式详解","tag":["Redis","主从复制","哨兵模式","高可用性","故障转移"],"category":"Redis","description":"详细介绍Redis主从复制和哨兵模式的原理、配置、工作流程以及实际应用","date":"2025-01-20T00:00:00.000Z","author":"nikola","icon":"paw","isOriginal":false,"sticky":false,"timeline":true,"article":true,"star":false,"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Redis主从复制与哨兵模式详解\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-01-20T00:00:00.000Z\\",\\"dateModified\\":\\"2025-12-07T16:02:41.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"nikola\\"}]}"],["meta",{"property":"og:url","content":"https://nikolazhang.github.io/posts/redis/04-Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E4%B8%8E%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F.html"}],["meta",{"property":"og:title","content":"Redis主从复制与哨兵模式详解"}],["meta",{"property":"og:description","content":"详细介绍Redis主从复制和哨兵模式的原理、配置、工作流程以及实际应用"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-12-07T16:02:41.000Z"}],["meta",{"property":"article:author","content":"nikola"}],["meta",{"property":"article:tag","content":"故障转移"}],["meta",{"property":"article:tag","content":"高可用性"}],["meta",{"property":"article:tag","content":"哨兵模式"}],["meta",{"property":"article:tag","content":"主从复制"}],["meta",{"property":"article:tag","content":"Redis"}],["meta",{"property":"article:published_time","content":"2025-01-20T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-12-07T16:02:41.000Z"}]]},"git":{"createdTime":1765117689000,"updatedTime":1765123361000,"contributors":[{"name":"我小叮当","username":"","email":"nikolazhang@163.com","commits":3}]},"readingTime":{"minutes":14.72,"words":4415},"filePathRelative":"posts/redis/04-Redis主从复制与哨兵模式.md"}');export{g as comp,v as data};
