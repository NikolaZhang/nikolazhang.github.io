import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as l,e as s,b as e,r as h,o as t}from"./app-DPXje-MH.js";const k={};function p(d,i){const a=h("Mermaid");return t(),l("div",null,[i[0]||(i[0]=s('<blockquote><p>深入解析Oracle索引结构、类型、原理及其在SQL优化中的应用，包括B树索引、位图索引、函数索引等实现机制与优化策略</p></blockquote><h2 id="一、索引概述" tabindex="-1"><a class="header-anchor" href="#一、索引概述"><span>一、索引概述</span></a></h2><h3 id="_1-1-索引的定义与作用" tabindex="-1"><a class="header-anchor" href="#_1-1-索引的定义与作用"><span>1.1 索引的定义与作用</span></a></h3><p>索引是数据库中用于提高数据查询效率的数据结构，它通过创建指向表中数据的指针来加速数据访问。索引的主要作用包括：</p><ul><li><strong>加速数据检索</strong>：减少需要扫描的数据量</li><li><strong>优化排序操作</strong>：利用索引的有序特性避免额外排序</li><li><strong>提高连接效率</strong>：在表连接操作中加速数据匹配</li><li><strong>维护数据完整性</strong>：唯一索引可以确保数据唯一性</li></ul><h3 id="_1-2-索引的优缺点" tabindex="-1"><a class="header-anchor" href="#_1-2-索引的优缺点"><span>1.2 索引的优缺点</span></a></h3><table><thead><tr><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>提高查询性能</td><td>占用额外存储空间</td></tr><tr><td>加速排序和分组</td><td>增加DML操作（INSERT/UPDATE/DELETE）的开销</td></tr><tr><td>确保数据唯一性</td><td>索引维护需要系统资源</td></tr><tr><td>减少I/O操作</td><td>过多索引会导致性能下降</td></tr></tbody></table><h2 id="二、oracle索引结构与类型" tabindex="-1"><a class="header-anchor" href="#二、oracle索引结构与类型"><span>二、Oracle索引结构与类型</span></a></h2><h3 id="_2-1-b树索引-b-tree-index" tabindex="-1"><a class="header-anchor" href="#_2-1-b树索引-b-tree-index"><span>2.1 B树索引（B-Tree Index）</span></a></h3><p>B树索引是Oracle中最常用的索引类型，适用于高基数列（取值范围大、重复值少的列）。</p><h4 id="_2-1-1-b树索引结构" tabindex="-1"><a class="header-anchor" href="#_2-1-1-b树索引结构"><span>2.1.1 B树索引结构</span></a></h4><p>B树索引采用平衡树结构，由根节点、分支节点和叶子节点组成：</p>',12)),e(a,{code:"eJxLy8kvT85ILCpRCHHhUgACx+hnC3a+6Gp63rQzVkFX107BKfppR9uzKeshYoaxEFVgKWcUKSOIlBNYyiX6af+2p2snoOiCSLmiSEF1OYOl3FCkjJGl3FGkTCBSLmApj+gXC3ue9bS/nNRhqGtoYACRcwXLeSLJGRjqGsFk3cCyXghZI6CsMUzWHSzrjZA1BsqagGQBmq12Rg=="}),i[1]||(i[1]=s(`<p><strong>结构特点：</strong></p><ul><li>所有叶子节点在同一层级</li><li>每个节点包含多个键值和指针</li><li>叶子节点包含索引列值和指向表数据的ROWID</li><li>分支节点包含指向下级节点的指针</li></ul><h4 id="_2-1-2-b树索引工作原理" tabindex="-1"><a class="header-anchor" href="#_2-1-2-b树索引工作原理"><span>2.1.2 B树索引工作原理</span></a></h4><ol><li>从根节点开始查找目标值</li><li>根据比较结果选择相应的分支节点</li><li>重复上述过程直到到达叶子节点</li><li>在叶子节点中找到目标键值和对应的ROWID</li><li>利用ROWID直接访问表中的数据行</li></ol><h3 id="_2-2-位图索引-bitmap-index" tabindex="-1"><a class="header-anchor" href="#_2-2-位图索引-bitmap-index"><span>2.2 位图索引（Bitmap Index）</span></a></h3><p>位图索引适用于低基数列（取值范围小、重复值多的列），如性别、状态等。</p><h4 id="_2-2-1-位图索引结构" tabindex="-1"><a class="header-anchor" href="#_2-2-1-位图索引结构"><span>2.2.1 位图索引结构</span></a></h4><p>位图索引为每个不同的键值创建一个位图，位图中的每一位表示对应行是否包含该键值。</p><div class="language-plaintext line-numbers-mode" data-highlighter="shiki" data-ext="plaintext" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-plaintext"><span class="line"><span>键值: &#39;男&#39;  &#39;女&#39;</span></span>
<span class="line"><span>行号: 1     0     1</span></span>
<span class="line"><span>      2     1     0</span></span>
<span class="line"><span>      3     0     1</span></span>
<span class="line"><span>      4     1     0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-2-位图索引优缺点" tabindex="-1"><a class="header-anchor" href="#_2-2-2-位图索引优缺点"><span>2.2.2 位图索引优缺点</span></a></h4><p><strong>优点：</strong></p><ul><li>存储空间小（位图压缩存储）</li><li>适合用于AND/OR查询</li><li>高效支持COUNT和聚合操作</li></ul><p><strong>缺点：</strong></p><ul><li>不适合高并发更新场景</li><li>在OLTP系统中性能较差</li><li>更新操作会导致锁争用</li></ul><h3 id="_2-3-其他索引类型" tabindex="-1"><a class="header-anchor" href="#_2-3-其他索引类型"><span>2.3 其他索引类型</span></a></h3><h4 id="_2-3-1-函数索引-function-based-index" tabindex="-1"><a class="header-anchor" href="#_2-3-1-函数索引-function-based-index"><span>2.3.1 函数索引（Function-Based Index）</span></a></h4><p>函数索引是基于表达式或函数计算结果创建的索引，用于加速包含函数或表达式的查询。</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> emp_upper_ename_idx</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">UPPER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ename));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_2-3-2-反向键索引-reverse-key-index" tabindex="-1"><a class="header-anchor" href="#_2-3-2-反向键索引-reverse-key-index"><span>2.3.2 反向键索引（Reverse Key Index）</span></a></h4><p>反向键索引将索引列值的字节顺序反转后存储，用于解决索引热点问题，如序列生成的主键。</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> emp_empno_rev_idx</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp(empno) REVERSE;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_2-3-3-分区索引-partitioned-index" tabindex="-1"><a class="header-anchor" href="#_2-3-3-分区索引-partitioned-index"><span>2.3.3 分区索引（Partitioned Index）</span></a></h4><p>分区索引与分区表配合使用，可以提高大型表的查询和维护性能。</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> emp_deptno_part_idx</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp(deptno) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">LOCAL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_2-3-4-全局索引与本地索引" tabindex="-1"><a class="header-anchor" href="#_2-3-4-全局索引与本地索引"><span>2.3.4 全局索引与本地索引</span></a></h4><ul><li><strong>全局索引</strong>：索引结构跨越所有分区</li><li><strong>本地索引</strong>：每个分区对应一个索引分区</li></ul><h2 id="三、索引创建与管理" tabindex="-1"><a class="header-anchor" href="#三、索引创建与管理"><span>三、索引创建与管理</span></a></h2><h3 id="_3-1-创建索引" tabindex="-1"><a class="header-anchor" href="#_3-1-创建索引"><span>3.1 创建索引</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 创建B树索引</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> emp_ename_idx</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp(ename);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 创建唯一索引</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> UNIQUE INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> emp_empno_idx</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp(empno);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 创建位图索引</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> BITMAP </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INDEX</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp_gender_idx </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp(gender);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 创建复合索引</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> emp_deptno_job_idx</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp(deptno, job);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 创建函数索引</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> emp_hire_year_idx</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp(EXTRACT(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">YEAR</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> hiredate));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-查看索引信息" tabindex="-1"><a class="header-anchor" href="#_3-2-查看索引信息"><span>3.2 查看索引信息</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查看用户所有索引</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> index_name, table_name, index_type </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> user_indexes </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;EMP&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查看索引列信息</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> index_name, column_name, column_position </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> user_ind_columns </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> table_name </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;EMP&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查看索引使用情况</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> v$object_usage;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-维护索引" tabindex="-1"><a class="header-anchor" href="#_3-3-维护索引"><span>3.3 维护索引</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 重建索引</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp_ename_idx </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">REBUILD</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 收集索引统计信息</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ANALYZE </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INDEX</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp_ename_idx COMPUTE </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">STATISTICS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 或使用DBMS_STATS包</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">EXEC</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> DBMS_STATS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">gather_index_stats</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;SCOTT&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;EMP_ENAME_IDX&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 删除索引</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DROP</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp_ename_idx;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="四、sql优化与索引使用" tabindex="-1"><a class="header-anchor" href="#四、sql优化与索引使用"><span>四、SQL优化与索引使用</span></a></h2><h3 id="_4-1-索引使用原则" tabindex="-1"><a class="header-anchor" href="#_4-1-索引使用原则"><span>4.1 索引使用原则</span></a></h3><ol><li><strong>选择合适的索引类型</strong>：根据列的基数和查询模式选择B树、位图或其他索引类型</li><li><strong>创建复合索引</strong>：将最常用的查询条件列放在前面</li><li><strong>避免索引失效</strong>：不要在索引列上使用函数、NOT、&lt;&gt;等操作</li><li><strong>考虑索引覆盖</strong>：如果索引包含查询所需的所有列，可以避免回表操作</li><li><strong>定期维护索引</strong>：重建碎片化索引，收集最新统计信息</li></ol><h3 id="_4-2-常见索引失效场景" tabindex="-1"><a class="header-anchor" href="#_4-2-常见索引失效场景"><span>4.2 常见索引失效场景</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1. 在索引列上使用函数</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> UPPER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ename) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;SMITH&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 除非有函数索引</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2. 使用NOT操作符</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> deptno </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 可能导致全表扫描</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3. 使用LIKE以%开头</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ename </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">LIKE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;%SMITH&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 不能使用索引</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 4. 对索引列进行运算</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> sal * </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 索引失效</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 5. 使用OR连接多个条件（除非所有条件都有索引）</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> deptno </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> OR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> job </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;MANAGER&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-sql优化案例" tabindex="-1"><a class="header-anchor" href="#_4-3-sql优化案例"><span>4.3 SQL优化案例</span></a></h3><h4 id="_4-3-1-案例1-单表查询优化" tabindex="-1"><a class="header-anchor" href="#_4-3-1-案例1-单表查询优化"><span>4.3.1 案例1：单表查询优化</span></a></h4><p><strong>原始查询（可能全表扫描）：</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> hiredate </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> TO_DATE(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;2020-01-01&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;YYYY-MM-DD&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>优化方案：</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 创建索引</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> emp_hiredate_idx</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp(hiredate);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 执行查询（使用索引）</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> hiredate </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> TO_DATE(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;2020-01-01&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;YYYY-MM-DD&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3-2-案例2-复合索引优化" tabindex="-1"><a class="header-anchor" href="#_4-3-2-案例2-复合索引优化"><span>4.3.2 案例2：复合索引优化</span></a></h4><p><strong>查询：</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ename, sal </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> deptno </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AND</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> job </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;MANAGER&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>优化方案：</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 创建复合索引（将选择性高的列放在前面）</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> emp_deptno_job_idx</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp(deptno, job);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 或创建覆盖索引（包含查询所需的所有列）</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> emp_deptno_job_ename_sal_idx</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp(deptno, job, ename, sal);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3-3-案例3-函数索引优化" tabindex="-1"><a class="header-anchor" href="#_4-3-3-案例3-函数索引优化"><span>4.3.3 案例3：函数索引优化</span></a></h4><p><strong>查询：</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> UPPER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ename) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;SMITH&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>优化方案：</strong></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 创建函数索引</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> emp_upper_ename_idx</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">UPPER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ename));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 执行查询（使用函数索引）</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> UPPER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ename) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;SMITH&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-执行计划分析" tabindex="-1"><a class="header-anchor" href="#_4-4-执行计划分析"><span>4.4 执行计划分析</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 使用EXPLAIN PLAN查看执行计划</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EXPLAIN PLAN </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FOR</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> deptno </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查看执行计划</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">DBMS_XPLAN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">DISPLAY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 或在SQL*Plus中使用</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> AUTOTRACE </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ON</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> deptno </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>执行计划中的索引相关操作：</strong></p><ul><li>INDEX UNIQUE SCAN：唯一索引扫描</li><li>INDEX RANGE SCAN：范围索引扫描</li><li>INDEX FULL SCAN：全索引扫描</li><li>INDEX FAST FULL SCAN：快速全索引扫描（并行）</li><li>INDEX SKIP SCAN：跳跃索引扫描</li></ul><h2 id="五、索引设计最佳实践" tabindex="-1"><a class="header-anchor" href="#五、索引设计最佳实践"><span>五、索引设计最佳实践</span></a></h2><h3 id="_5-1-索引设计原则" tabindex="-1"><a class="header-anchor" href="#_5-1-索引设计原则"><span>5.1 索引设计原则</span></a></h3><ol><li><strong>分析查询模式</strong>：根据实际查询需求设计索引</li><li><strong>考虑选择性</strong>：为高选择性的列创建索引（选择性=唯一值数/总行数）</li><li><strong>避免过度索引</strong>：每个索引都会增加维护成本</li><li><strong>使用复合索引</strong>：将常用查询条件组合为复合索引</li><li><strong>考虑数据分布</strong>：避免在分布不均匀的列上创建位图索引</li></ol><h3 id="_5-2-索引维护最佳实践" tabindex="-1"><a class="header-anchor" href="#_5-2-索引维护最佳实践"><span>5.2 索引维护最佳实践</span></a></h3><ol><li><p><strong>定期重建碎片化索引</strong>：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emp_ename_idx </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">REBUILD</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>收集统计信息</strong>：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">EXEC</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> DBMS_STATS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">gather_table_stats</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;SCOTT&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;EMP&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, cascade </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> TRUE);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>监控索引使用情况</strong>：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> index_name, table_name, used</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> v$object_usage;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>删除未使用的索引</strong>：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DROP</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> unused_index_name;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><h2 id="六、索引与性能调优" tabindex="-1"><a class="header-anchor" href="#六、索引与性能调优"><span>六、索引与性能调优</span></a></h2><h3 id="_6-1-索引对性能的影响" tabindex="-1"><a class="header-anchor" href="#_6-1-索引对性能的影响"><span>6.1 索引对性能的影响</span></a></h3><p><strong>正面影响：</strong></p><ul><li>加速查询响应时间</li><li>减少I/O操作</li><li>优化排序操作</li></ul><p><strong>负面影响：</strong></p><ul><li>增加存储空间</li><li>降低INSERT/UPDATE/DELETE性能</li><li>增加数据库维护成本</li></ul><h3 id="_6-2-oltp与olap系统索引策略" tabindex="-1"><a class="header-anchor" href="#_6-2-oltp与olap系统索引策略"><span>6.2 OLTP与OLAP系统索引策略</span></a></h3><p><strong>OLTP系统：</strong></p><ul><li>优先考虑B树索引</li><li>避免位图索引</li><li>控制索引数量</li><li>关注高选择性列</li></ul><p><strong>OLAP系统：</strong></p><ul><li>可以使用位图索引</li><li>支持函数索引</li><li>考虑分区索引</li><li>关注查询性能</li></ul><h2 id="七、总结" tabindex="-1"><a class="header-anchor" href="#七、总结"><span>七、总结</span></a></h2><p>Oracle索引是提高数据库查询性能的重要工具，但索引的设计和使用需要谨慎。正确的索引策略应该基于实际的查询模式、数据分布和系统类型。</p><p><strong>主要结论：</strong></p><ol><li>选择合适的索引类型（B树、位图、函数索引等）</li><li>避免索引失效的常见错误</li><li>定期维护和优化索引</li><li>根据系统类型（OLTP/OLAP）制定不同的索引策略</li><li>结合执行计划分析进行SQL优化</li></ol><p>通过合理的索引设计和SQL优化，可以显著提高Oracle数据库的性能，为用户提供更好的体验。</p>`,79))])}const g=n(k,[["render",p]]),c=JSON.parse('{"path":"/posts/database/01-Oracle%E7%B4%A2%E5%BC%95%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8ESQL%E4%BC%98%E5%8C%96.html","title":"Oracle索引深度解析与SQL优化","lang":"en-US","frontmatter":{"isOriginal":true,"title":"Oracle索引深度解析与SQL优化","tag":["oracle","索引","SQL优化","数据库"],"category":"database","description":"深入解析Oracle索引结构、类型、原理及其在SQL优化中的应用，包括B树索引、位图索引、函数索引等实现机制与优化策略","sticky":false,"timeline":true,"article":true,"star":false,"icon":"code","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Oracle索引深度解析与SQL优化\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-12-07T17:47:52.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"我小叮当、\\",\\"url\\":\\"https://nikolazhang.github.io\\"}]}"],["meta",{"property":"og:url","content":"https://nikolazhang.github.io/posts/database/01-Oracle%E7%B4%A2%E5%BC%95%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8ESQL%E4%BC%98%E5%8C%96.html"}],["meta",{"property":"og:title","content":"Oracle索引深度解析与SQL优化"}],["meta",{"property":"og:description","content":"深入解析Oracle索引结构、类型、原理及其在SQL优化中的应用，包括B树索引、位图索引、函数索引等实现机制与优化策略"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-12-07T17:47:52.000Z"}],["meta",{"property":"article:tag","content":"数据库"}],["meta",{"property":"article:tag","content":"SQL优化"}],["meta",{"property":"article:tag","content":"索引"}],["meta",{"property":"article:tag","content":"oracle"}],["meta",{"property":"article:modified_time","content":"2025-12-07T17:47:52.000Z"}]]},"git":{"createdTime":1764967325000,"updatedTime":1765129672000,"contributors":[{"name":"我小叮当","username":"","email":"nikolazhang@163.com","commits":4}]},"readingTime":{"minutes":7.6,"words":2281},"filePathRelative":"posts/database/01-Oracle索引深度解析与SQL优化.md"}');export{g as comp,c as data};
