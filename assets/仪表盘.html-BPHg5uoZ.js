import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as e,a as n,f as i,e as l,o as t}from"./app-fOLsFtI8.js";const r={};function p(d,s){return t(),e("div",null,[s[0]||(s[0]=n("blockquote",null,[n("p",null,"使用Hystrix仪表盘我们可以通过图形界面的形式,看到我们的应用运行状态")],-1)),i("more"),s[1]||(s[1]=l(`<h2 id="hystrix仪表盘" tabindex="-1"><a class="header-anchor" href="#hystrix仪表盘"><span>Hystrix仪表盘</span></a></h2><blockquote><p>Spring Cloud 整合了Hystrix Dashboard. 主要用来实时监控Hystrix的各项指标信息. 通过Hystrix Dashboard反馈的实时信息. 我们可以发现系统中存在的问题, 从而及时采取对应措施.</p></blockquote><h3 id="_1-步骤" tabindex="-1"><a class="header-anchor" href="#_1-步骤"><span>1 步骤</span></a></h3><h4 id="_1-1-创建springboot工程" tabindex="-1"><a class="header-anchor" href="#_1-1-创建springboot工程"><span>1.1 创建SpringBoot工程</span></a></h4><h4 id="_1-2-配置pom" tabindex="-1"><a class="header-anchor" href="#_1-2-配置pom"><span>1.2 配置pom</span></a></h4><p>主要添加Hystrix Hystrix-Dashboard actuator</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>    &lt;dependency&gt;</span></span>
<span class="line"><span>        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span>
<span class="line"><span>        &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span></span>
<span class="line"><span>    &lt;/dependency&gt;</span></span>
<span class="line"><span>    &lt;dependency&gt;</span></span>
<span class="line"><span>        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></span>
<span class="line"><span>        &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;</span></span>
<span class="line"><span>    &lt;/dependency&gt;</span></span>
<span class="line"><span>    &lt;dependency&gt;</span></span>
<span class="line"><span>        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></span>
<span class="line"><span>        &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix-dashboard&lt;/artifactId&gt;</span></span>
<span class="line"><span>    &lt;/dependency&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-3-为应用主类添加-enablehystrixdashboard-启用hystrixdashboard功能" tabindex="-1"><a class="header-anchor" href="#_1-3-为应用主类添加-enablehystrixdashboard-启用hystrixdashboard功能"><span>1.3 为应用主类添加@EnableHystrixDashboard. 启用HystrixDashboard功能.</span></a></h4><h4 id="_1-4-配置yml-或者-properties" tabindex="-1"><a class="header-anchor" href="#_1-4-配置yml-或者-properties"><span>1.4 配置yml 或者 properties</span></a></h4><p>要使用一个未被占用的端口</p><h4 id="_1-5-访问验证" tabindex="-1"><a class="header-anchor" href="#_1-5-访问验证"><span>1.5 访问验证</span></a></h4><p><a href="http://ip" target="_blank" rel="noopener noreferrer">http://ip</a>:port/hystrix 从页面上我们可以看到，HystrixDashboard支持三种不同的监控方式：</p><ul><li>默认的集群监控</li><li>指定的集群监控</li><li>单体应用的监控 Hystrix Dashboard监控单实例节点需要通过访问实例的/hystrix.stream接口来实现, 我们自然要为服务实例添加这个端点.</li></ul><ul><li>在服务实例pom.xml中增加actuator监控模块以开启监控相关的端点. 并引入断路器的依赖spring-cloud-starter-hystrix</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>    &lt;dependency&gt;</span></span>
<span class="line"><span>        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span>
<span class="line"><span>        &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span></span>
<span class="line"><span>    &lt;/dependency&gt;</span></span>
<span class="line"><span>    &lt;dependency&gt;</span></span>
<span class="line"><span>        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></span>
<span class="line"><span>        &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;</span></span>
<span class="line"><span>    &lt;/dependency&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>服务实例主类使用@EnableCircuitBreaker注解, 开启断路器功能.</p></li><li><p>监控界面 实心圆: 颜色: 绿黄橙红.健康度依次递减 大小: 表示请求流量, 流量越大实心圆越大</p></li></ul><p>以上只是对某一个应用进行监控,当监控多个应用时需要使用turbine进行集群监控</p><h3 id="_2-turbine集群监控" tabindex="-1"><a class="header-anchor" href="#_2-turbine集群监控"><span>2 Turbine集群监控</span></a></h3><p>Hystrix Dashboard中的/turbine.stream是对集群使用的. 使用方法如下:</p><ol><li>步骤同上,首先创建一个springboot工程, pom中引入turbine和actuator</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span>
<span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;spring-boot-starter-turbine&lt;/artifactId&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>之后,在应用主类中应用@EnableTurbine注解开启Turbine</li><li>最后配置properties</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>spring:</span></span>
<span class="line"><span>  application:</span></span>
<span class="line"><span>    name: turbine</span></span>
<span class="line"><span>server:</span></span>
<span class="line"><span>  port: 9002</span></span>
<span class="line"><span>manage:</span></span>
<span class="line"><span>  port: 9102</span></span>
<span class="line"><span>eureka:</span></span>
<span class="line"><span>  client:</span></span>
<span class="line"><span>    serviceUrl:</span></span>
<span class="line"><span>      defaultZone: http://localhost:1111/eureka</span></span>
<span class="line"><span>turbine:</span></span>
<span class="line"><span>  #该属性指定需要收集监控信息的服务名</span></span>
<span class="line"><span>  app-config: bookservice</span></span>
<span class="line"><span>  #指定集群名称, 当服务增加时可以使用集群来划分不同的应用集合</span></span>
<span class="line"><span>  cluster-name-expression: &#39;NikolaZhang&#39;</span></span>
<span class="line"><span>  #true表示同一主机的服务通过主机名和端口名的组合进行区分, 默认情况使用主机名进行区分, 但这会将主机上的多个服务聚合成一个服务.</span></span>
<span class="line"><span>  combine-host-port: true</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>在浏览器中输入<a href="http://localhost:9000/turbine.stream" target="_blank" rel="noopener noreferrer">http://localhost:9000/turbine.stream</a></li></ol><h3 id="_3-与消息代理结合" tabindex="-1"><a class="header-anchor" href="#_3-与消息代理结合"><span>3 与消息代理结合</span></a></h3><p>Spring Cloud在封装Turbine的时候, 还封装了基于消息代理的收集实现. 我们可以将所有需要收集的监控信息输出到消息代理中, 然后turbine服务再从消息代理中异步获取这些监控信息. 最后将这些监控信息聚合并输出到Hystrix Dashboard中. 实现步骤如下:</p><ol><li>首先创建springboot工程, 引入turbine-amqp和actuator</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span>
<span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;spring-boot-starter-turbine-amqp&lt;/artifactId&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>应用主类要使用@EnableTurbineStream注解</li><li>配置properties</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>spring:</span></span>
<span class="line"><span>  application:</span></span>
<span class="line"><span>    name: turbine</span></span>
<span class="line"><span>server:</span></span>
<span class="line"><span>  port: 9002</span></span>
<span class="line"><span>manage:</span></span>
<span class="line"><span>  port: 9102</span></span>
<span class="line"><span>eureka:</span></span>
<span class="line"><span>  client:</span></span>
<span class="line"><span>    serviceUrl:</span></span>
<span class="line"><span>      defaultZone: http://localhost:1111/eureka</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>最后,对服务进行配置, 使监控信息能够输出到RabbitMQ 只需要向pom中添加如下pom</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;spring-boot-starter-netflix-hystrix-amqp&lt;/artifactId&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>验证输入<a href="http://localhost:9000/turbine.stream" target="_blank" rel="noopener noreferrer">http://localhost:9000/turbine.stream</a>. 效果同上, 但是这里的监控信息是通过消息代理异步获取之后输出到Hystrix Dashboard中的.</li></ol><h3 id="end" tabindex="-1"><a class="header-anchor" href="#end"><span>end</span></a></h3><p>到此为止，服务容错已经介绍完毕，这周末我会把之前的程序测试一下，然后再水一篇博客。</p>`,35))])}const g=a(r,[["render",p]]),u=JSON.parse('{"path":"/posts/springcloud/%E4%BB%AA%E8%A1%A8%E7%9B%98.html","title":"服务容错 Spring Cloud Hystrix [3]","lang":"en-US","frontmatter":{"isOriginal":true,"title":"服务容错 Spring Cloud Hystrix [3]","date":"2018-12-27T00:00:00.000Z","tag":["hystrix"],"category":"技术","description":"继续服务容错的相关介绍, 这次主要是仪表盘, 用于监控我们的微服务实例","sticky":false,"timeline":true,"article":true,"star":false,"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"服务容错 Spring Cloud Hystrix [3]\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2018-12-27T00:00:00.000Z\\",\\"dateModified\\":\\"2024-12-31T08:40:08.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"我小叮当、\\",\\"url\\":\\"https://nikolazhang.github.io\\"}]}"],["meta",{"property":"og:url","content":"https://nikolazhang.github.io/posts/springcloud/%E4%BB%AA%E8%A1%A8%E7%9B%98.html"}],["meta",{"property":"og:title","content":"服务容错 Spring Cloud Hystrix [3]"}],["meta",{"property":"og:description","content":"继续服务容错的相关介绍, 这次主要是仪表盘, 用于监控我们的微服务实例"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-12-31T08:40:08.000Z"}],["meta",{"property":"article:tag","content":"hystrix"}],["meta",{"property":"article:published_time","content":"2018-12-27T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-12-31T08:40:08.000Z"}]]},"git":{"createdTime":1665625617000,"updatedTime":1735634408000,"contributors":[{"name":"zhangxu","username":"zhangxu","email":"nikolazhang@163.com","commits":5,"url":"https://github.com/zhangxu"},{"name":"nikola","username":"nikola","email":"nikolazhang@163.com","commits":1,"url":"https://github.com/nikola"},{"name":"我小叮当","username":"","email":"nikolazhang@163.com","commits":1}]},"readingTime":{"minutes":3.41,"words":1024},"filePathRelative":"posts/springcloud/仪表盘.md"}');export{g as comp,u as data};
